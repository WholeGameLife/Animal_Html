<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŠ¶æ€æ± æŸ¥çœ‹å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        
        .status-card {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
            cursor: pointer;
        }
        
        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .filter-btn {
            transition: all 0.2s ease;
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .type-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        /* æ‚¬æµ®æç¤ºæ¡†æ ·å¼ */
        .status-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background: rgba(17, 24, 39, 0.98);
            border: 2px solid rgba(139, 92, 246, 0.5);
            border-radius: 12px;
            padding: 16px;
            min-width: 320px;
            max-width: 400px;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        .status-card:hover .status-tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
            pointer-events: auto;
        }
        
        .status-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: rgba(139, 92, 246, 0.5);
        }
        
        .param-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .param-item:last-child {
            border-bottom: none;
        }
        
        .param-label {
            color: #9ca3af;
            font-size: 0.875rem;
        }
        
        .param-value {
            color: #a78bfa;
            font-weight: 600;
            font-size: 0.875rem;
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-7xl mx-auto">
        <!-- æ ‡é¢˜ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">ğŸ”® çŠ¶æ€æ± æŸ¥çœ‹å™¨</h1>
            <p class="text-white/80">æŸ¥çœ‹å’Œç­›é€‰æ‰€æœ‰å¯ç”¨çŠ¶æ€</p>
        </div>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
            <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 text-white">
                <div class="text-sm opacity-80">æ€»çŠ¶æ€æ•°</div>
                <div class="text-3xl font-bold" id="total-count">0</div>
            </div>
            <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 text-white">
                <div class="text-sm opacity-80">å¢ç›ŠçŠ¶æ€</div>
                <div class="text-3xl font-bold" id="buff-count">0</div>
            </div>
            <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 text-white">
                <div class="text-sm opacity-80">å‡ç›ŠçŠ¶æ€</div>
                <div class="text-3xl font-bold" id="debuff-count">0</div>
            </div>
            <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 text-white">
                <div class="text-sm opacity-80">æ§åˆ¶çŠ¶æ€</div>
                <div class="text-3xl font-bold" id="control-count">0</div>
            </div>
            <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 text-white">
                <div class="text-sm opacity-80">ç‰¹æ®ŠçŠ¶æ€</div>
                <div class="text-3xl font-bold" id="special-count">0</div>
            </div>
        </div>

        <!-- ç­›é€‰å™¨ -->
        <div class="bg-white/10 backdrop-blur-md rounded-lg p-6 mb-6">
            <div>
                <h3 class="text-white font-bold mb-3">æŒ‰ç±»å‹ç­›é€‰</h3>
                <div class="flex flex-wrap gap-2" id="type-filters">
                    <button class="filter-btn active px-4 py-2 rounded-lg bg-white/20 text-white" data-type="all">
                        å…¨éƒ¨
                    </button>
                </div>
            </div>
        </div>

        <!-- çŠ¶æ€åˆ—è¡¨ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="statuses-container">
            <!-- çŠ¶æ€å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- è¿”å›æŒ‰é’® -->
        <div class="mt-8 text-center flex gap-4 justify-center">
            <button onclick="location.href='status_designer.html'" class="px-6 py-3 bg-white/20 hover:bg-white/30 text-white rounded-lg backdrop-blur-md transition-all">
                âœï¸ çŠ¶æ€è®¾è®¡å™¨
            </button>
            <button onclick="window.history.back()" class="px-6 py-3 bg-white/20 hover:bg-white/30 text-white rounded-lg backdrop-blur-md transition-all">
                â† è¿”å›
            </button>
        </div>
    </div>

    <script>
        // çŠ¶æ€ç±»å‹æ˜ å°„
        const TYPE_MAP = {
            'buff': { name: 'ğŸ’š å¢ç›Š', color: 'bg-green-600 text-white' },
            'debuff': { name: 'ğŸ’” å‡ç›Š', color: 'bg-red-600 text-white' },
            'control': { name: 'ğŸ­ æ§åˆ¶', color: 'bg-purple-600 text-white' },
            'dot': { name: 'ğŸ©¸ æŒç»­ä¼¤å®³', color: 'bg-orange-600 text-white' },
            'special': { name: 'âœ¨ ç‰¹æ®Š', color: 'bg-blue-600 text-white' }
        };

        const EFFECT_MAP = {
            'damage': 'é€ æˆä¼¤å®³',
            'heal': 'æ¢å¤ç”Ÿå‘½',
            'buff_attack': 'å¢åŠ æ”»å‡»',
            'buff_defense': 'å¢åŠ é˜²å¾¡',
            'buff_speed': 'å¢åŠ æ•æ·',
            'debuff_attack': 'é™ä½æ”»å‡»',
            'debuff_defense': 'é™ä½é˜²å¾¡',
            'debuff_speed': 'é™ä½æ•æ·',
            'stun': 'çœ©æ™•',
            'silence': 'æ²‰é»˜',
            'freeze': 'å†°å†»',
            'burn': 'ç¼çƒ§',
            'poison': 'ä¸­æ¯’',
            'bleed': 'æµè¡€',
            'frostbite': 'å†»ä¼¤',
            'paralyze': 'éº»ç—¹',
            'shield': 'æŠ¤ç›¾',
            'immunity': 'å…ç–«',
            'reflect': 'åå¼¹',
            'lifesteal': 'ç”Ÿå‘½æ±²å–',
            'regen': 'å›å¤',
            'purify': 'å‡€åŒ–',
            'dispel': 'é©±æ•£',
            'no_heal': 'ç¦ç–—',
            'heal_reduce': 'å‡ç–—',
            'invincible': 'æ— æ•Œ',
            'stealth': 'éšèº«',
            'taunt': 'å˜²è®½',
            'dot-damage': 'æŒç»­æ‰£è¡€',
            'hot-heal': 'æŒç»­å›è¡€',
            'cannot-act': 'æ— æ³•è¡ŒåŠ¨',
            'cannot-attack': 'æ— æ³•æ”»å‡»',
            'cannot-defend': 'æ— æ³•é˜²å¾¡',
            'boost-damage': 'æå‡ä¼¤å®³',
            'boost-attack': 'æå‡æ”»å‡»',
            'boost-defense': 'æå‡é˜²å¾¡',
            'boost-speed': 'æå‡é€Ÿåº¦',
            'reduce-damage': 'é™ä½ä¼¤å®³',
            'reduce-attack': 'é™ä½æ”»å‡»',
            'reduce-defense': 'é™ä½é˜²å¾¡',
            'reduce-agility': 'é™ä½é€Ÿåº¦',
            'ignore-defense': 'æ— è§†é˜²å¾¡',
            'first-strike': 'æ— è§†æ•æ·ç›´æ¥è¡ŒåŠ¨',
            'double-action': 'è¡ŒåŠ¨ä¸¤æ¬¡',
            'reverse-stats': 'å±æ€§åè½¬',
            'element-advantage': 'å±æ€§å…‹åˆ¶',
            'element-bonus': 'å±æ€§å¢ä¼¤',
            'reset-cooldown': 'é‡ç½®å†·å´'
        };

        let allStatuses = [];
        let currentType = 'all';

        // åŠ è½½çŠ¶æ€æ± 
        async function loadStatuses() {
            try {
                const statusPool = JSON.parse(localStorage.getItem('STATUS_POOL') || '[]');
                allStatuses = statusPool;
                
                // æ›´æ–°ç»Ÿè®¡
                updateStatistics();
                
                // ç”Ÿæˆç­›é€‰å™¨
                generateFilters();
                
                // æ˜¾ç¤ºçŠ¶æ€
                displayStatuses();
            } catch (error) {
                console.error('åŠ è½½çŠ¶æ€å¤±è´¥:', error);
                document.getElementById('statuses-container').innerHTML = 
                    '<div class="col-span-full text-center text-white">åŠ è½½çŠ¶æ€å¤±è´¥ï¼Œè¯·ç¡®ä¿çŠ¶æ€æ± æ•°æ®å­˜åœ¨</div>';
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStatistics() {
            document.getElementById('total-count').textContent = allStatuses.length;
            document.getElementById('buff-count').textContent =
                allStatuses.filter(s => (s.type || inferStatusType(s.effects)) === 'buff').length;
            document.getElementById('debuff-count').textContent =
                allStatuses.filter(s => (s.type || inferStatusType(s.effects)) === 'debuff').length;
            document.getElementById('control-count').textContent =
                allStatuses.filter(s => (s.type || inferStatusType(s.effects)) === 'control').length;
            document.getElementById('special-count').textContent =
                allStatuses.filter(s => {
                    const type = s.type || inferStatusType(s.effects);
                    return type === 'special' || type === 'dot';
                }).length;
        }
        
        // è‡ªåŠ¨æ¨æ–­çŠ¶æ€ç±»å‹
        function inferStatusType(effects) {
            if (!effects || effects.length === 0) return 'special';
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«ç‰¹å®šæ•ˆæœ
            const hasControl = effects.some(e => ['cannot-act', 'cannot-attack', 'cannot-defend'].includes(e));
            const hasDot = effects.some(e => ['dot-damage', 'hot-heal'].includes(e));
            const hasDebuff = effects.some(e => ['reduce-defense', 'reduce-damage', 'reduce-agility'].includes(e));
            const hasBuff = effects.some(e => ['hot-heal'].includes(e));
            
            if (hasControl) return 'control';
            if (hasDot) return 'dot';
            if (hasDebuff) return 'debuff';
            if (hasBuff) return 'buff';
            return 'special';
        }

        // ç”Ÿæˆç­›é€‰å™¨
        function generateFilters() {
            // è·å–æ‰€æœ‰å”¯ä¸€çš„ç±»å‹ï¼ˆåŒ…æ‹¬æ¨æ–­çš„ï¼‰
            const types = [...new Set(allStatuses.map(s => s.type || inferStatusType(s.effects)))].filter(Boolean);
            const typeContainer = document.getElementById('type-filters');
            
            types.forEach(type => {
                const typeInfo = TYPE_MAP[type] || { name: type, color: 'bg-gray-600' };
                const btn = document.createElement('button');
                btn.className = 'filter-btn px-4 py-2 rounded-lg bg-white/20 text-white';
                btn.dataset.type = type;
                btn.textContent = typeInfo.name;
                btn.onclick = () => filterByType(type);
                typeContainer.appendChild(btn);
            });
        }

        // æŒ‰ç±»å‹ç­›é€‰
        function filterByType(type) {
            currentType = type;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('[data-type]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === type);
            });
            
            displayStatuses();
        }
        
        // åˆå§‹åŒ–"å…¨éƒ¨"æŒ‰é’®
        function initializeAllButtons() {
            const typeAllBtn = document.querySelector('[data-type="all"]');
            if (typeAllBtn) {
                typeAllBtn.onclick = () => filterByType('all');
            }
        }

        // æ˜¾ç¤ºçŠ¶æ€
        function displayStatuses() {
            const container = document.getElementById('statuses-container');
            
            // ç­›é€‰çŠ¶æ€
            let filteredStatuses = allStatuses;
            
            if (currentType !== 'all') {
                filteredStatuses = filteredStatuses.filter(s => (s.type || inferStatusType(s.effects)) === currentType);
            }

            // ç”ŸæˆçŠ¶æ€å¡ç‰‡
            if (filteredStatuses.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-white">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„çŠ¶æ€</div>';
                return;
            }

            container.innerHTML = filteredStatuses.map(status => createStatusCard(status)).join('');
        }

        // åˆ›å»ºçŠ¶æ€å¡ç‰‡
        function createStatusCard(status) {
            // è‡ªåŠ¨æ¨æ–­ç±»å‹ï¼ˆå¦‚æœæ²¡æœ‰typeå­—æ®µï¼‰
            const statusType = status.type || inferStatusType(status.effects);
            const typeInfo = TYPE_MAP[statusType] || { name: statusType, color: 'bg-gray-600' };
            const effects = status.effects || [];
            
            // æ”¯æŒçŠ¶æ€è®¾è®¡å™¨çš„effectåç§°æ˜ å°„
            const EFFECT_NAME_MAP = {
                'dot-damage': 'æŒç»­æ‰£è¡€',
                'hot-heal': 'æŒç»­å›è¡€',
                'cannot-act': 'æ— æ³•è¡ŒåŠ¨',
                'cannot-attack': 'æ— æ³•æ”»å‡»',
                'cannot-defend': 'æ— æ³•é˜²å¾¡',
                'reduce-defense': 'æ°¸ä¹…å‡é˜²',
                'reduce-damage': 'æ°¸ä¹…å‡ä¼¤',
                'reduce-agility': 'æ°¸ä¹…å‡é€Ÿ',
                'ignore-defense': 'æ— è§†é˜²å¾¡',
                'first-strike': 'æ— è§†æ•æ·ç›´æ¥è¡ŒåŠ¨',
                'double-action': 'è¡ŒåŠ¨ä¸¤æ¬¡',
                'reverse-stats': 'å±æ€§åè½¬',
                'element-advantage': 'å±æ€§å…‹åˆ¶',
                'element-bonus': 'å±æ€§å¢ä¼¤'
            };
            
            const effectBadges = effects.map(effect => {
                 const effectName = EFFECT_NAME_MAP[effect] || EFFECT_MAP[effect] || effect;
                 return `<span class="bg-gray-700 text-gray-300 px-2 py-1 rounded-md text-xs">${effectName}</span>`;
            }).join('');
            
            // è§£æå‚æ•° - æ”¯æŒçŠ¶æ€è®¾è®¡å™¨çš„æ•°æ®ç»“æ„
            let paramsHtml = '';
            
            const paramDisplay = (label, value) => {
                if (value !== undefined && value !== 0 && value !== '' && value !== null) {
                    return `<div class="param-item"><span class="param-label">${label}</span><span class="param-value">${value}</span></div>`;
                }
                return '';
            };

            paramsHtml += paramDisplay('æŒç»­æ–¹å¼', status.isPermanent ? 'æˆ˜æ–—å†…æ°¸ä¹…' : `æ¯å±‚${status.durationPerStack || 3}å›åˆ`);
            paramsHtml += paramDisplay('æœ€å¤§å±‚æ•°', status.maxStacks > 1 ? status.maxStacks : undefined);
            paramsHtml += paramDisplay('å¯é©±æ•£', status.canPurify === false ? 'å¦' : (status.canPurify === true ? 'æ˜¯' : undefined));
            paramsHtml += paramDisplay('å”¯ä¸€æ•ˆæœ', status.uniqueEffect ? 'æ˜¯' : undefined);
            paramsHtml += paramDisplay('å±‚æ•°è‡ªå¢é•¿', status.autoGrow ? 'æ˜¯' : undefined);
            paramsHtml += paramDisplay('æ¯å›åˆå¢åŠ ', status.autoGrow && status.growRate ? `${status.growRate}å±‚` : undefined);
            
            // å›¾æ ‡æ˜¾ç¤º - æ”¯æŒiconImageï¼ˆå›¾ç‰‡ï¼‰æˆ–iconï¼ˆemojiï¼‰
            let iconDisplay = '';
            if (status.iconImage) {
                iconDisplay = `<img src="${status.iconImage}" class="w-12 h-12 object-contain" style="max-height: 48px;">`;
            } else if (status.icon) {
                iconDisplay = status.icon;
            } else {
                iconDisplay = 'â“';
            }
            
            let iconDisplaySmall = '';
            if (status.iconImage) {
                iconDisplaySmall = `<img src="${status.iconImage}" class="w-12 h-12 object-contain" style="max-height: 48px;">`;
            } else if (status.icon) {
                iconDisplaySmall = status.icon;
            } else {
                iconDisplaySmall = 'â“';
            }
            
            const tooltipHtml = `
                <div class="status-tooltip">
                    <div class="flex items-start gap-4 mb-3">
                        <div class="text-4xl mt-1 flex items-center justify-center" style="min-width: 48px;">${iconDisplay}</div>
                        <div>
                            <h4 class="font-bold text-xl text-white">${status.name}</h4>
                            <p class="text-sm text-gray-400">${status.description || 'æ— æè¿°'}</p>
                        </div>
                    </div>
                    ${effectBadges ? `<div class="space-y-2 mb-3">
                         <div class="flex flex-wrap gap-2">${effectBadges}</div>
                    </div>` : ''}
                    ${paramsHtml ? `<div class="bg-black/20 rounded-lg p-3">${paramsHtml}</div>` : ''}
                </div>
            `;

            return `
                <div class="status-card bg-white/10 backdrop-blur-md rounded-lg p-4 text-white">
                    ${tooltipHtml}
                    <div class="flex items-center gap-3">
                        <div class="text-3xl flex items-center justify-center" style="min-width: 48px; min-height: 48px;">${iconDisplaySmall}</div>
                        <div class="flex-1">
                            <h3 class="font-bold">${status.name}</h3>
                            <div class="flex gap-2 mt-1.5 flex-wrap">
                                <span class="type-badge ${typeInfo.color}">
                                    ${typeInfo.name}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            initializeAllButtons();
            loadStatuses();
        };
    </script>
</body>
</html>