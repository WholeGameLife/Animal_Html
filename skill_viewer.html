<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ€èƒ½æ± æŸ¥çœ‹å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        
        .skill-card {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
            cursor: pointer;
        }
        
        .skill-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .filter-btn {
            transition: all 0.2s ease;
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .category-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .type-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        /* æ‚¬æµ®æç¤ºæ¡†æ ·å¼ */
        .skill-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background: rgba(17, 24, 39, 0.98);
            border: 2px solid rgba(139, 92, 246, 0.5);
            border-radius: 12px;
            padding: 16px;
            min-width: 320px;
            max-width: 400px;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        .skill-card:hover .skill-tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
            pointer-events: auto;
        }
        
        .skill-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: rgba(139, 92, 246, 0.5);
        }
        
        .param-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .param-item:last-child {
            border-bottom: none;
        }
        
        .param-label {
            color: #9ca3af;
            font-size: 0.875rem;
        }
        
        .param-value {
            color: #a78bfa;
            font-weight: 600;
            font-size: 0.875rem;
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-7xl mx-auto">
        <!-- æ ‡é¢˜ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">ğŸ¯ æŠ€èƒ½æ± æŸ¥çœ‹å™¨</h1>
            <p class="text-white/80">æŸ¥çœ‹å’Œç­›é€‰æ‰€æœ‰å¯ç”¨æŠ€èƒ½</p>
        </div>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 text-white">
                <div class="text-sm opacity-80">æ€»æŠ€èƒ½æ•°</div>
                <div class="text-3xl font-bold" id="total-count">0</div>
            </div>
            <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 text-white">
                <div class="text-sm opacity-80">æ”»å‡»æŠ€èƒ½</div>
                <div class="text-3xl font-bold" id="attack-count">0</div>
            </div>
            <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 text-white">
                <div class="text-sm opacity-80">é˜²å¾¡æŠ€èƒ½</div>
                <div class="text-3xl font-bold" id="defense-count">0</div>
            </div>
            <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 text-white">
                <div class="text-sm opacity-80">è¾…åŠ©æŠ€èƒ½</div>
                <div class="text-3xl font-bold" id="support-count">0</div>
            </div>
        </div>

        <!-- ç­›é€‰å™¨ -->
        <div class="bg-white/10 backdrop-blur-md rounded-lg p-6 mb-6">
            <div class="mb-4">
                <h3 class="text-white font-bold mb-3">æŒ‰ç±»åˆ«ç­›é€‰</h3>
                <div class="flex flex-wrap gap-2" id="category-filters">
                    <button class="filter-btn active px-4 py-2 rounded-lg bg-white/20 text-white" data-category="all">
                        å…¨éƒ¨
                    </button>
                </div>
            </div>
            
            <div class="mb-4">
                <h3 class="text-white font-bold mb-3">æŒ‰ç±»å‹ç­›é€‰</h3>
                <div class="flex flex-wrap gap-2" id="type-filters">
                    <button class="filter-btn active px-4 py-2 rounded-lg bg-white/20 text-white" data-type="all">
                        å…¨éƒ¨
                    </button>
                </div>
            </div>
            
            <div>
                <h3 class="text-white font-bold mb-3">æŒ‰ç¨€æœ‰åº¦ç­›é€‰</h3>
                <div class="flex flex-wrap gap-2" id="rarity-filters">
                    <button class="filter-btn active px-4 py-2 rounded-lg bg-white/20 text-white" data-rarity="all">
                        å…¨éƒ¨
                    </button>
                </div>
            </div>
        </div>

        <!-- æŠ€èƒ½åˆ—è¡¨ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="skills-container">
            <!-- æŠ€èƒ½å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- è¿”å›æŒ‰é’® -->
        <div class="mt-8 text-center">
            <button onclick="window.history.back()" class="px-6 py-3 bg-white/20 hover:bg-white/30 text-white rounded-lg backdrop-blur-md transition-all">
                â† è¿”å›
            </button>
        </div>
    </div>

    <script>
        // ç±»åˆ«å’Œç±»å‹çš„ä¸­æ–‡æ˜ å°„
        const CATEGORY_MAP = {
            'element-water': { name: 'ğŸ’§ æ°´ç³»', color: 'bg-blue-500' },
            'element-fire': { name: 'ğŸ”¥ ç«ç³»', color: 'bg-red-500' },
            'element-grass': { name: 'ğŸŒ¿ è‰ç³»', color: 'bg-green-600' },
            'element-wind': { name: 'ğŸ’¨ é£ç³»', color: 'bg-cyan-400' },
            'element-electric': { name: 'âš¡ ç”µç³»', color: 'bg-yellow-500' },
            'element-earth': { name: 'ğŸª¨ åœŸç³»', color: 'bg-yellow-700' },
            'mutation-dark': { name: 'ğŸŒ‘ é»‘åŒ–', color: 'bg-gray-900' },
            'mutation-light': { name: 'â˜€ï¸ ç™½åŒ–', color: 'bg-gray-100 text-gray-900' },
            'mutation-crystal': { name: 'ğŸ’ æ™¶åŒ–', color: 'bg-purple-500' },
            'mutation-shadow': { name: 'ğŸ‘¤ å½±åŒ–', color: 'bg-gray-700' },
            'mutation-thunder': { name: 'âš¡ æç”µ', color: 'bg-yellow-400' },
            'mutation-holy': { name: 'âœ¨ åœ£è¾‰', color: 'bg-yellow-200 text-yellow-900' },
            'mutation-psychic': { name: 'ğŸ”® å¼‚èƒ½', color: 'bg-pink-600' },
            'mutation-void': { name: 'ğŸŒ€ è™šæ— ', color: 'bg-indigo-600' },
            'mutation-annihilate': { name: 'ğŸ’€ æ¹®ç­', color: 'bg-red-900' },
            'mutation-chaos': { name: 'ğŸ–¤ æš—èš€', color: 'bg-purple-900' },
            'mutation-rebirth': { name: 'â™»ï¸ è½®å›', color: 'bg-green-700' }
        };

        const TYPE_MAP = {
            'attack': { name: 'æ”»å‡»', color: 'bg-red-600 text-white' },
            'defense': { name: 'é˜²å¾¡', color: 'bg-blue-600 text-white' },
            'agility': { name: 'æ•æ·', color: 'bg-green-600 text-white' },
            'buff': { name: 'å¢ç›Š', color: 'bg-yellow-600 text-white' },
            'debuff': { name: 'å‡ç›Š', color: 'bg-purple-600 text-white' },
            'heal': { name: 'æ²»ç–—', color: 'bg-pink-600 text-white' }
        };

        const RARITY_MAP = {
            'shiny': { name: 'âœ¨ é—ªå…‰', color: 'bg-yellow-500' },
            'prismatic': { name: 'ğŸŒˆ å¹»å½©', color: 'bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500' },
            'stellar': { name: 'â­ æ˜ŸèŠ’', color: 'bg-yellow-300 text-gray-900' }
        };

        const EFFECT_MAP = {
            'direct_attack': 'ç›´æ¥æ”»å‡»',
            'multi_attack': 'å¤šæ®µæ”»å‡»',
            'dot_damage': 'é™„åŠ ä¼¤å®³',
            'percent_damage': 'ç™¾åˆ†æ¯”ä¼¤å®³',
            'direct_defense': 'ç›´æ¥é˜²å¾¡',
            'continuous_defense': 'æŒç»­é˜²å¾¡',
            'defense_counter': 'é˜²å¾¡åå‡»',
            'direct_speed': 'ç›´æ¥åŠ é€Ÿ',
            'continuous_speed': 'æŒç»­åŠ é€Ÿ',
            'buff_attack': 'å¢æ”»',
            'buff_defense': 'å¢é˜²',
            'buff_attack_damage': 'æ”»å‡»å¢ä¼¤',
            'buff_attack_defense': 'æ”»å‡»å¢é˜²',
            'buff_attack_speed': 'æ”»å‡»å¢é€Ÿ',
            'buff_attack_status': 'æ”»å‡»å¢ç›Š',
            'buff_defense_damage': 'é˜²å¾¡å¢ä¼¤',
            'buff_defense_speed': 'é˜²å¾¡å¢é€Ÿ',
            'buff_defense_defense': 'é˜²å¾¡å¢é˜²',
            'buff_defense_status': 'é˜²å¾¡å¢ç›Š',
            'buff_speed': 'å¢é€Ÿ',
            'buff_status_enemy': 'æ–½åŠ å¼‚å¸¸',
            'buff_purify': 'å‡€åŒ–',
            'buff_heal_amp': 'å¢åŠ æ²»ç–—',
            'buff_element_damage': 'å±æ€§å¢ä¼¤',
            'debuff_attack': 'å‡æ”»',
            'debuff_defense': 'å‡é˜²',
            'debuff_attack_damage': 'æ”»å‡»å‡ä¼¤',
            'debuff_attack_defense': 'æ”»å‡»å‡é˜²',
            'debuff_attack_speed': 'æ”»å‡»å‡é€Ÿ',
            'debuff_attack_status': 'æ”»å‡»å‡ç›Š',
            'debuff_defense_damage': 'é˜²å¾¡å‡ä¼¤',
            'debuff_defense_defense': 'é˜²å¾¡å‡é˜²',
            'debuff_defense_speed': 'é˜²å¾¡å‡é€Ÿ',
            'debuff_defense_status': 'é˜²å¾¡å‡ç›Š',
            'debuff_speed': 'å‡é€Ÿ',
            'debuff_status_self': 'è‡ªèº«å¼‚å¸¸',
            'debuff_no_heal': 'ç¦ç–—',
            'debuff_heal_reduce': 'å‡ç–—',
            'debuff_element_damage': 'å±æ€§å‡ä¼¤',
            'heal_direct': 'ç›´æ¥æ²»ç–—',
            'heal_continuous': 'æŒç»­æ²»ç–—',
            'heal_percent': 'ç™¾åˆ†æ¯”æ¢å¤',
            'heal_rebirth': 'é‡ç”Ÿ',
            'heal_lifesteal': 'ç”Ÿå‘½æ±²å–',
            'damage': 'ä¼¤å®³',
            'critical': 'æš´å‡»',
            'lifesteal': 'ç”Ÿå‘½æ±²å–',
            'bonus_damage': 'é¢å¤–ä¼¤å®³',
            'armor_pierce': 'æŠ¤ç”²ç©¿é€',
            'true_damage': 'çœŸå®ä¼¤å®³',
            'damage_amp': 'ä¼¤å®³å¢å¹…',
            'counter': 'åå‡»',
            'passive_defense': 'è¢«åŠ¨é˜²å¾¡',
            'damage_reduction': 'ä¼¤å®³å‡å…',
            'guaranteed_dodge': 'å¿…å®šé—ªé¿',
            'buff_agility': 'æ•æ·å¢ç›Š',
            'passive_attack': 'è¢«åŠ¨æ”»å‡»',
            'passive_agility': 'è¢«åŠ¨æ•æ·',
            'regen': 'å›å¤',
            'heal_reduce': 'æ²»ç–—å‰Šå¼±',
            'rebirth': 'é‡ç”Ÿ',
            'burn': 'ç¼çƒ§'
        };

        let allSkills = [];
        let currentCategory = 'all';
        let currentType = 'all';
        let currentRarity = 'all';

        // åŠ è½½æŠ€èƒ½æ± 
        async function loadSkills() {
            try {
                const skillPool = JSON.parse(localStorage.getItem('SKILL_POOL') || '[]');
                allSkills = skillPool;
                
                // æ›´æ–°ç»Ÿè®¡
                updateStatistics();
                
                // ç”Ÿæˆç­›é€‰å™¨
                generateFilters();
                
                // æ˜¾ç¤ºæŠ€èƒ½
                displaySkills();
            } catch (error) {
                console.error('åŠ è½½æŠ€èƒ½å¤±è´¥:', error);
                document.getElementById('skills-container').innerHTML = 
                    '<div class="col-span-full text-center text-white">åŠ è½½æŠ€èƒ½å¤±è´¥ï¼Œè¯·ç¡®ä¿æŠ€èƒ½æ± æ•°æ®å­˜åœ¨</div>';
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStatistics() {
            document.getElementById('total-count').textContent = allSkills.length;
            document.getElementById('attack-count').textContent = 
                allSkills.filter(s => s.type === 'attack').length;
            document.getElementById('defense-count').textContent = 
                allSkills.filter(s => s.type === 'defense').length;
            document.getElementById('support-count').textContent = 
                allSkills.filter(s => ['buff', 'debuff', 'heal', 'agility'].includes(s.type)).length;
        }

        // ç”Ÿæˆç­›é€‰å™¨
        function generateFilters() {
            // è·å–æ‰€æœ‰å”¯ä¸€çš„ç±»åˆ«
            const categories = [...new Set(allSkills.map(s => s.category))].filter(Boolean);
            const categoryContainer = document.getElementById('category-filters');
            
            categories.forEach(category => {
                const categoryInfo = CATEGORY_MAP[category] || { name: category, color: 'bg-gray-500' };
                const btn = document.createElement('button');
                btn.className = 'filter-btn px-4 py-2 rounded-lg bg-white/20 text-white';
                btn.dataset.category = category;
                btn.textContent = categoryInfo.name;
                btn.onclick = () => filterByCategory(category);
                categoryContainer.appendChild(btn);
            });

            // è·å–æ‰€æœ‰å”¯ä¸€çš„ç±»å‹
            const types = [...new Set(allSkills.map(s => s.type))].filter(Boolean);
            const typeContainer = document.getElementById('type-filters');
            
            types.forEach(type => {
                const typeInfo = TYPE_MAP[type] || { name: type, color: 'bg-gray-600' };
                const btn = document.createElement('button');
                btn.className = 'filter-btn px-4 py-2 rounded-lg bg-white/20 text-white';
                btn.dataset.type = type;
                btn.textContent = typeInfo.name;
                btn.onclick = () => filterByType(type);
                typeContainer.appendChild(btn);
            });

            // è·å–æ‰€æœ‰å”¯ä¸€çš„ç¨€æœ‰åº¦
            const rarities = [...new Set(allSkills.map(s => s.rarity))].filter(Boolean);
            const rarityContainer = document.getElementById('rarity-filters');
            
            rarities.forEach(rarity => {
                const rarityInfo = RARITY_MAP[rarity] || { name: rarity, color: 'bg-gray-600' };
                const btn = document.createElement('button');
                btn.className = 'filter-btn px-4 py-2 rounded-lg bg-white/20 text-white';
                btn.dataset.rarity = rarity;
                btn.textContent = rarityInfo.name;
                btn.onclick = () => filterByRarity(rarity);
                rarityContainer.appendChild(btn);
            });
        }

        // æŒ‰ç±»åˆ«ç­›é€‰
        function filterByCategory(category) {
            currentCategory = category;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('[data-category]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.category === category);
            });
            
            displaySkills();
        }

        // æŒ‰ç±»å‹ç­›é€‰
        function filterByType(type) {
            currentType = type;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('[data-type]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === type);
            });
            
            displaySkills();
        }

        // æŒ‰ç¨€æœ‰åº¦ç­›é€‰
        function filterByRarity(rarity) {
            currentRarity = rarity;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('[data-rarity]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.rarity === rarity);
            });
            
            displaySkills();
        }
        
        // åˆå§‹åŒ–"å…¨éƒ¨"æŒ‰é’®
        function initializeAllButtons() {
            // ç±»åˆ«"å…¨éƒ¨"æŒ‰é’®
            const categoryAllBtn = document.querySelector('[data-category="all"]');
            if (categoryAllBtn) {
                categoryAllBtn.onclick = () => filterByCategory('all');
            }
            
            // ç±»å‹"å…¨éƒ¨"æŒ‰é’®
            const typeAllBtn = document.querySelector('[data-type="all"]');
            if (typeAllBtn) {
                typeAllBtn.onclick = () => filterByType('all');
            }
            
            // ç¨€æœ‰åº¦"å…¨éƒ¨"æŒ‰é’®
            const rarityAllBtn = document.querySelector('[data-rarity="all"]');
            if (rarityAllBtn) {
                rarityAllBtn.onclick = () => filterByRarity('all');
            }
        }

        // æ˜¾ç¤ºæŠ€èƒ½
        function displaySkills() {
            const container = document.getElementById('skills-container');
            
            // ç­›é€‰æŠ€èƒ½
            let filteredSkills = allSkills;
            
            if (currentCategory !== 'all') {
                filteredSkills = filteredSkills.filter(s => s.category === currentCategory);
            }
            
            if (currentType !== 'all') {
                filteredSkills = filteredSkills.filter(s => s.type === currentType);
            }
            
            if (currentRarity !== 'all') {
                filteredSkills = filteredSkills.filter(s => s.rarity === currentRarity);
            }

            // ç”ŸæˆæŠ€èƒ½å¡ç‰‡
            if (filteredSkills.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-white">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æŠ€èƒ½</div>';
                return;
            }

            container.innerHTML = filteredSkills.map(skill => createSkillCard(skill)).join('');
        }

        // åˆ›å»ºæŠ€èƒ½å¡ç‰‡
        function createSkillCard(skill) {
            const categoryInfo = CATEGORY_MAP[skill.category] || { name: skill.category, color: 'bg-gray-500' };
            const typeInfo = TYPE_MAP[skill.type] || { name: skill.type, color: 'bg-gray-600' };
            const effectName = EFFECT_MAP[skill.effect] || skill.effect;
            
            // è§£æå‚æ•°
            const params = skill.params || {};
            let paramsHtml = '';
            
            if (params.cooldown) {
                paramsHtml += `<div class="text-xs text-gray-300">å†·å´: ${params.cooldown}å›åˆ</div>`;
            }
            if (params.duration) {
                paramsHtml += `<div class="text-xs text-gray-300">æŒç»­: ${params.duration}å›åˆ</div>`;
            }
            if (params.attackBonus) {
                paramsHtml += `<div class="text-xs text-green-300">æ”»å‡»åŠ æˆ: ${params.attackBonus}</div>`;
            }
            if (params.defenseBonus) {
                paramsHtml += `<div class="text-xs text-blue-300">é˜²å¾¡åŠ æˆ: ${params.defenseBonus}</div>`;
            }
            if (params.speedBonus) {
                paramsHtml += `<div class="text-xs text-yellow-300">é€Ÿåº¦åŠ æˆ: ${(params.speedBonus * 100).toFixed(0)}%</div>`;
            }
            if (params.count && params.count > 1) {
                paramsHtml += `<div class="text-xs text-purple-300">æ¬¡æ•°: ${params.count}</div>`;
            }
            if (params.multiBonus && params.multiBonus.length > 0) {
                paramsHtml += `<div class="text-xs text-orange-300">å€ç‡: [${params.multiBonus.join(', ')}]</div>`;
            }
            if (params.healBonus) {
                paramsHtml += `<div class="text-xs text-pink-300">æ²»ç–—: ${(params.healBonus * 100).toFixed(0)}%</div>`;
            }

            return `
                <div class="skill-card bg-white/10 backdrop-blur-md rounded-lg p-4 text-white">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <span class="text-3xl">${skill.icon}</span>
                            <div>
                                <h3 class="font-bold text-lg">${skill.name}</h3>
                                <div class="flex gap-2 mt-1 flex-wrap">
                                    <span class="category-badge ${categoryInfo.color} text-white">
                                        ${categoryInfo.name}
                                    </span>
                                    ${skill.rarity ? `<span class="category-badge ${RARITY_MAP[skill.rarity]?.color || 'bg-gray-500'} text-white">
                                        ${RARITY_MAP[skill.rarity]?.name || skill.rarity}
                                    </span>` : ''}
                                    <span class="type-badge ${typeInfo.color}">
                                        ${typeInfo.name}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <p class="text-sm text-gray-200 mb-3">${skill.description || skill.desc || 'æ— æè¿°'}</p>
                    
                    <div class="border-t border-white/20 pt-3 space-y-1">
                        <div class="text-xs text-gray-300">æ•ˆæœ: ${effectName}</div>
                        ${paramsHtml}
                    </div>
                    
                    <div class="mt-3 text-xs text-gray-400">
                        åˆ›å»ºæ—¶é—´: ${new Date(skill.createdAt).toLocaleString('zh-CN')}
                    </div>
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            initializeAllButtons();
            loadSkills();
        };
    </script>
</body>
</html>
