<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŠ¶æ€è®¾è®¡å™¨ - ç”µå­ç›†æ ½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        
        .status-card {
            transition: all 0.3s ease;
        }
        
        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .effect-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-7xl mx-auto">
        <!-- æ ‡é¢˜ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">ğŸ”® çŠ¶æ€è®¾è®¡å™¨ ğŸ”®</h1>
            <p class="text-blue-200 mb-3">è®¾è®¡æˆ˜æ–—ä¸­çš„çŠ¶æ€æ•ˆæœ - å±‚æ•°å åŠ ã€æŒç»­ä¼¤å®³ä¸æ§åˆ¶</p>
            <div class="flex justify-center gap-3">
                <a href="status_viewer.html"
                   class="inline-flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                    <span>ğŸ‘ï¸</span>
                    <span>æŸ¥çœ‹çŠ¶æ€æ± </span>
                </a>
                <button onclick="window.history.back()"
                        class="inline-flex items-center gap-2 bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                    <span>â†</span>
                    <span>è¿”å›</span>
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- å·¦ä¾§ï¼šçŠ¶æ€è®¾è®¡è¡¨å• -->
            <div class="lg:col-span-2 bg-gray-900/80 backdrop-blur-lg rounded-xl p-6 border border-gray-700">
                <h2 class="text-2xl font-bold text-white mb-6">ğŸ¨ åˆ›å»ºæ–°çŠ¶æ€</h2>
                
                <form id="status-form" class="space-y-4">
                    <!-- åŸºç¡€ä¿¡æ¯ -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">çŠ¶æ€åç§° *</label>
                            <input type="text" id="status-name" required
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">çŠ¶æ€å›¾æ ‡ * (ä»…æ”¯æŒä¸Šä¼ å›¾ç‰‡)</label>
                            <div class="space-y-2">
                                <div class="flex gap-2">
                                    <label for="icon-upload"
                                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg cursor-pointer flex items-center justify-center gap-2">
                                        <span>ğŸ“</span>
                                        <span>é€‰æ‹©å›¾ç‰‡ä¸Šä¼ </span>
                                    </label>
                                    <input type="file" id="icon-upload" accept="image/*" class="hidden">
                                    <button type="button" id="clear-icon-btn"
                                        class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
                                        æ¸…é™¤
                                    </button>
                                </div>
                                <div id="icon-preview" class="hidden bg-gray-800 border border-gray-600 rounded-lg p-2 flex items-center justify-center" style="height: 60px;">
                                    <img id="icon-preview-img" class="max-h-full max-w-full object-contain" style="max-height: 50px;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- çŠ¶æ€æè¿° -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">çŠ¶æ€æè¿°</label>
                        <textarea id="status-description" rows="2" placeholder="æè¿°è¿™ä¸ªçŠ¶æ€çš„æ•ˆæœ..."
                            class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500 resize-none"></textarea>
                    </div>

                    <!-- çŠ¶æ€å‚æ•° -->
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">
                                æŒç»­æ—¶é—´æ¨¡å¼ *
                            </label>
                            <select id="duration-mode"
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500">
                                <option value="status">çŠ¶æ€æ•´ä½“æŒç»­</option>
                                <option value="stack">æ¯å±‚ç‹¬ç«‹è®¡æ—¶</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">é€‰æ‹©æŒç»­æ—¶é—´çš„è®¡ç®—æ–¹å¼</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">å±‚æ•°ç³»ç»Ÿ</label>
                            <select id="status-hasStacks"
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500">
                                <option value="true">å¯ç”¨å±‚æ•°</option>
                                <option value="false">ä¸ä½¿ç”¨å±‚æ•°</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">æ§åˆ¶ã€çœ©æ™•ç­‰çŠ¶æ€å¯ä¸ä½¿ç”¨å±‚æ•°</p>
                        </div>
                    </div>
                    
                    <!-- çŠ¶æ€æ•´ä½“æŒç»­é…ç½® -->
                    <div id="status-duration-params" class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">çŠ¶æ€æŒç»­å›åˆ *</label>
                            <div class="space-y-2">
                                <input type="number" id="status-duration" min="1" value="10" required
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500">
                                <label class="flex items-center gap-2 text-white text-sm cursor-pointer">
                                    <input type="checkbox" id="status-permanent" class="w-4 h-4 cursor-pointer">
                                    <span>çŠ¶æ€æ°¸ä¹…å­˜åœ¨</span>
                                </label>
                                <p class="text-xs text-gray-500">çŠ¶æ€æœ¬èº«çš„æŒç»­æ—¶é—´</p>
                            </div>
                        </div>
                        <div></div>
                    </div>
                    
                    <!-- æ¯å±‚ç‹¬ç«‹è®¡æ—¶é…ç½® -->
                    <div id="stack-params" class="grid grid-cols-2 gap-4 mb-4" style="display: none;">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">æ¯å±‚æŒç»­å›åˆ *</label>
                            <div class="space-y-2">
                                <input type="number" id="status-durationPerStack" min="1" value="3"
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500">
                                <label class="flex items-center gap-2 text-white text-sm cursor-pointer">
                                    <input type="checkbox" id="status-stackPermanent" class="w-4 h-4 cursor-pointer">
                                    <span>å±‚æ•°æ°¸ä¹…å­˜åœ¨</span>
                                </label>
                                <p class="text-xs text-gray-500">æ¯ä¸€å±‚çš„æŒç»­æ—¶é—´</p>
                            </div>
                        </div>
                        <div></div>
                    </div>
                    
                    <!-- æœ€å¤§å±‚æ•°ï¼ˆé€šç”¨é…ç½®ï¼Œå¯ç”¨å±‚æ•°æ—¶æ˜¾ç¤ºï¼‰ -->
                    <div id="max-stacks-param" class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">æœ€å¤§å±‚æ•°</label>
                            <input type="number" id="status-maxStacks" min="1" value="1"
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500">
                        </div>
                        <div></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">å¯è¢«å‡€åŒ–</label>
                            <select id="status-canPurify"
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500">
                                <option value="true">æ˜¯</option>
                                <option value="false">å¦</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">å”¯ä¸€æ•ˆæœ</label>
                            <select id="status-uniqueEffect"
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500">
                                <option value="false">å¦</option>
                                <option value="true">æ˜¯</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">æ˜¯ï¼šæ— è®ºå¤šå°‘å±‚ä»…ç”Ÿæ•ˆä¸€ä¸ª</p>
                        </div>
                    </div>
                    <div id="stack-grow-params" class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">å±‚æ•°è‡ªå¢é•¿</label>
                            <div class="space-y-2">
                                <select id="status-autoGrow"
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500">
                                    <option value="false">å¦</option>
                                    <option value="true">æ˜¯</option>
                                </select>
                                <p class="text-xs text-gray-500">æ˜¯ï¼šçŠ¶æ€å­˜åœ¨æ—¶æ¯å›åˆè‡ªåŠ¨å¢åŠ å±‚æ•°</p>
                            </div>
                        </div>
                        <div id="grow-rate-container" style="display: none;">
                            <label class="block text-sm font-medium text-gray-300 mb-2">æ¯å›åˆå¢åŠ å±‚æ•°</label>
                            <input type="number" id="status-growRate" min="1" value="1"
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-blue-500">
                            <p class="text-xs text-gray-500 mt-1">æ¯å›åˆè‡ªåŠ¨å¢åŠ çš„å±‚æ•°</p>
                        </div>
                    </div>

                    <!-- çŠ¶æ€æ•ˆæœé€‰æ‹© -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">çŠ¶æ€æ•ˆæœ * (å¯å¤šé€‰)</label>
                        <div class="bg-gray-800 border border-gray-600 rounded-lg p-4 space-y-3 max-h-96 overflow-y-auto">
                            <!-- ä¼¤å®³/æ²»ç–—ç±» -->
                            <div>
                                <div class="text-xs font-bold text-red-400 mb-2">ğŸ’” ä¼¤å®³/æ²»ç–—ç±»</div>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="dot-damage">
                                        <span>æŒç»­æ‰£è¡€</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="hot-heal">
                                        <span>æŒç»­å›è¡€</span>
                                    </label>
                                </div>
                            </div>

                            <!-- æ§åˆ¶ç±» -->
                            <div>
                                <div class="text-xs font-bold text-purple-400 mb-2">ğŸš« æ§åˆ¶ç±»</div>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="cannot-act">
                                        <span>æ— æ³•è¡ŒåŠ¨</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="cannot-attack">
                                        <span>æ— æ³•æ”»å‡»</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="cannot-defend">
                                        <span>æ— æ³•é˜²å¾¡</span>
                                    </label>
                                </div>
                            </div>

                            <!-- å±æ€§å¢ç›Šç±» -->
                            <div>
                                <div class="text-xs font-bold text-green-400 mb-2">ğŸ’ª å±æ€§å¢ç›Šç±»</div>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="boost-damage">
                                        <span>æå‡ä¼¤å®³</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="boost-attack">
                                        <span>æå‡æ”»å‡»</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="boost-defense">
                                        <span>æå‡é˜²å¾¡</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="boost-speed">
                                        <span>æå‡é€Ÿåº¦</span>
                                    </label>
                                </div>
                            </div>

                            <!-- å±æ€§å‡ç›Šç±» -->
                            <div>
                                <div class="text-xs font-bold text-red-400 mb-2">ğŸ”» å±æ€§å‡ç›Šç±»</div>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="reduce-damage">
                                        <span>é™ä½ä¼¤å®³</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="reduce-attack">
                                        <span>é™ä½æ”»å‡»</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="reduce-defense">
                                        <span>é™ä½é˜²å¾¡</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="reduce-agility">
                                        <span>é™ä½é€Ÿåº¦</span>
                                    </label>
                                </div>
                            </div>

                            <!-- ç‰¹æ®Šæ•ˆæœç±» -->
                            <div>
                                <div class="text-xs font-bold text-cyan-400 mb-2">âœ¨ ç‰¹æ®Šæ•ˆæœç±»</div>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="ignore-defense">
                                        <span>æ— è§†é˜²å¾¡</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="first-strike">
                                        <span>æ— è§†æ•æ·ç›´æ¥è¡ŒåŠ¨</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="double-action">
                                        <span>è¡ŒåŠ¨ä¸¤æ¬¡</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="reverse-stats">
                                        <span>å±æ€§åè½¬</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="element-advantage">
                                        <span>å±æ€§å…‹åˆ¶</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="element-bonus">
                                        <span>å±æ€§å¢ä¼¤</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-white text-sm cursor-pointer hover:bg-gray-700 p-2 rounded">
                                        <input type="checkbox" class="effect-checkbox" data-effect="reset-cooldown">
                                        <span>é‡ç½®å†·å´</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- åŠ¨æ€æ•ˆæœå€¼é…ç½® -->
                    <div id="effect-values-container" class="space-y-3 bg-gray-800/50 rounded-lg p-4 border border-gray-600">
                        <h3 class="text-sm font-bold text-gray-300 mb-3">ğŸ“Š æ•ˆæœæ•°å€¼é…ç½®ï¼ˆæ¯å±‚ï¼‰</h3>
                        <div id="effect-values" class="space-y-2">
                            <p class="text-xs text-gray-500">é€‰æ‹©çŠ¶æ€æ•ˆæœåï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå¯¹åº”çš„æ•°å€¼é…ç½®</p>
                        </div>
                    </div>

                    <!-- æŒ‰é’® -->
                    <div class="flex gap-4 pt-4">
                        <button type="submit" id="submit-btn"
                            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                            <span id="submit-text">âœ¨ åˆ›å»ºçŠ¶æ€</span>
                        </button>
                        <button type="button" id="cancel-edit-btn" class="hidden bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                            âŒ å–æ¶ˆç¼–è¾‘
                        </button>
                        <button type="button" id="clear-btn"
                            class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                            ğŸ”„ æ¸…ç©º
                        </button>
                    </div>
                </form>
            </div>

            <!-- å³ä¾§ï¼šçŠ¶æ€é¢„è§ˆå’Œåˆ—è¡¨ -->
            <div class="space-y-6">
                <!-- çŠ¶æ€é¢„è§ˆ -->
                <div class="bg-gray-900/80 backdrop-blur-lg rounded-xl p-6 border border-gray-700">
                    <h3 class="text-xl font-bold text-white mb-4">ğŸ‘ï¸ çŠ¶æ€é¢„è§ˆ</h3>
                    <div id="status-preview" class="status-card bg-gray-800 rounded-lg p-4 border-2 border-gray-600">
                        <div class="text-center text-gray-500">
                            <div class="text-4xl mb-2">â“</div>
                            <div class="text-sm">å¡«å†™è¡¨å•æŸ¥çœ‹é¢„è§ˆ</div>
                        </div>
                    </div>
                </div>

                <!-- å·²åˆ›å»ºçŠ¶æ€åˆ—è¡¨ -->
                <div class="bg-gray-900/80 backdrop-blur-lg rounded-xl p-6 border border-gray-700">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">ğŸ“‹ çŠ¶æ€åˆ—è¡¨ (<span id="status-count">0</span>)</h3>
                        <div class="flex gap-2">
                            <label for="import-file"
                                class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold py-2 px-4 rounded-lg transition-colors cursor-pointer">
                                ğŸ“¤ å¯¼å…¥
                            </label>
                            <input type="file" id="import-file" accept=".json" class="hidden">
                            <button id="export-btn"
                                class="bg-green-600 hover:bg-green-700 text-white text-sm font-bold py-2 px-4 rounded-lg transition-colors">
                                ğŸ“¥ å¯¼å‡º
                            </button>
                        </div>
                    </div>
                    <div id="status-list" class="space-y-3 max-h-96 overflow-y-auto">
                        <div class="text-center text-gray-500 text-sm py-8">
                            æš‚æ— çŠ¶æ€
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ•ˆæœé…ç½®
        const EFFECT_CONFIG = {
            'dot-damage': { name: 'æŒç»­æ‰£è¡€', needsSource: true, needsValue: true, label: 'æ¯å±‚ä¼¤å®³æ¯”ä¾‹', defaultValue: 0.05, min: 0, step: 0.01 },
            'hot-heal': { name: 'æŒç»­å›è¡€', needsSource: true, needsValue: true, label: 'æ¯å±‚æ²»ç–—æ¯”ä¾‹', defaultValue: 0.03, min: 0, step: 0.01 },
            'cannot-act': { name: 'æ— æ³•è¡ŒåŠ¨', needsSource: false, needsValue: false },
            'cannot-attack': { name: 'æ— æ³•æ”»å‡»', needsSource: false, needsValue: false },
            'cannot-defend': { name: 'æ— æ³•é˜²å¾¡', needsSource: false, needsValue: false },
            'boost-damage': { name: 'æå‡ä¼¤å®³', needsSource: true, needsValue: true, label: 'æ¯å±‚æå‡æ¯”ä¾‹', defaultValue: 0.1, min: 0, step: 0.05 },
            'boost-attack': { name: 'æå‡æ”»å‡»', needsSource: true, needsValue: true, label: 'æ¯å±‚æå‡æ¯”ä¾‹', defaultValue: 0.1, min: 0, step: 0.05 },
            'boost-defense': { name: 'æå‡é˜²å¾¡', needsSource: true, needsValue: true, label: 'æ¯å±‚æå‡æ¯”ä¾‹', defaultValue: 0.1, min: 0, step: 0.05 },
            'boost-speed': { name: 'æå‡é€Ÿåº¦', needsSource: true, needsValue: true, label: 'æ¯å±‚æå‡æ¯”ä¾‹', defaultValue: 0.1, min: 0, step: 0.05 },
            'reduce-damage': { name: 'é™ä½ä¼¤å®³', needsSource: true, needsValue: true, label: 'æ¯å±‚é™ä½æ¯”ä¾‹', defaultValue: 0.1, min: 0, max: 1, step: 0.05 },
            'reduce-attack': { name: 'é™ä½æ”»å‡»', needsSource: true, needsValue: true, label: 'æ¯å±‚é™ä½æ¯”ä¾‹', defaultValue: 0.1, min: 0, max: 1, step: 0.05 },
            'reduce-defense': { name: 'é™ä½é˜²å¾¡', needsSource: true, needsValue: true, label: 'æ¯å±‚é™ä½æ¯”ä¾‹', defaultValue: 0.1, min: 0, max: 1, step: 0.05 },
            'reduce-agility': { name: 'é™ä½é€Ÿåº¦', needsSource: true, needsValue: true, label: 'æ¯å±‚é™ä½æ¯”ä¾‹', defaultValue: 0.1, min: 0, max: 1, step: 0.05 },
            'ignore-defense': { name: 'æ— è§†é˜²å¾¡', needsSource: false, needsValue: true, label: 'æ¯å±‚æ— è§†ç™¾åˆ†æ¯”', defaultValue: 0.1, min: 0, max: 1, step: 0.05 },
            'first-strike': { name: 'æ— è§†æ•æ·ç›´æ¥è¡ŒåŠ¨', needsSource: false, needsValue: false },
            'double-action': { name: 'è¡ŒåŠ¨ä¸¤æ¬¡', needsSource: false, needsValue: false },
            'reverse-stats': { name: 'å±æ€§åè½¬', needsSource: false, needsValue: false },
            'element-advantage': { name: 'å±æ€§å…‹åˆ¶', needsSource: false, needsValue: true, label: 'æ¯å±‚å¢ä¼¤å€ç‡', defaultValue: 1.5, min: 1, step: 0.1 },
            'element-bonus': { name: 'å±æ€§å¢ä¼¤', needsSource: true, needsValue: true, label: 'æ¯å±‚å¢ä¼¤ç™¾åˆ†æ¯”', defaultValue: 0.2, min: 0, step: 0.05 },
            'reset-cooldown': { name: 'é‡ç½®å†·å´', needsSource: false, needsValue: false }
        };

        // çŠ¶æ€æ± å­˜å‚¨
        let statuses = JSON.parse(localStorage.getItem('STATUS_POOL') || '[]');
        let editingIndex = -1;

        // DOMå…ƒç´ 
        const form = document.getElementById('status-form');
        const preview = document.getElementById('status-preview');
        const statusList = document.getElementById('status-list');
        const statusCount = document.getElementById('status-count');
        const effectValues = document.getElementById('effect-values');

        // å›¾ç‰‡æ•°æ®å­˜å‚¨
        let iconImageData = null;

        // åˆå§‹åŒ–
        function init() {
            renderStatusList();
            setupFormListeners();
            updateStatusCount();
        }

        // è®¾ç½®è¡¨å•ç›‘å¬å™¨
        function setupFormListeners() {
            // è¡¨å•è¾“å…¥å˜åŒ–æ—¶æ›´æ–°é¢„è§ˆ
            form.querySelectorAll('input, select, textarea').forEach(input => {
                input.addEventListener('input', updatePreview);
            });

            // æ•ˆæœå¤é€‰æ¡†å˜åŒ–æ—¶æ›´æ–°æ•ˆæœå€¼é…ç½®
            document.querySelectorAll('.effect-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateEffectValues();
                    updatePreview();
                });
            });
            
            // æŒç»­æ—¶é—´æ¨¡å¼é€‰æ‹©å™¨
            document.getElementById('duration-mode').addEventListener('change', (e) => {
                const mode = e.target.value;
                const statusDurationParams = document.getElementById('status-duration-params');
                const stackParams = document.getElementById('stack-params');
                
                if (mode === 'status') {
                    // çŠ¶æ€æ•´ä½“æŒç»­æ¨¡å¼
                    statusDurationParams.style.display = 'grid';
                    stackParams.style.display = 'none';
                    document.getElementById('status-duration').required = !document.getElementById('status-permanent').checked;
                    document.getElementById('status-durationPerStack').required = false;
                } else {
                    // æ¯å±‚ç‹¬ç«‹è®¡æ—¶æ¨¡å¼
                    statusDurationParams.style.display = 'none';
                    stackParams.style.display = 'grid';
                    document.getElementById('status-duration').required = false;
                    document.getElementById('status-durationPerStack').required = !document.getElementById('status-stackPermanent').checked;
                }
                updatePreview();
            });
            
            // çŠ¶æ€æ°¸ä¹…å­˜åœ¨å¤é€‰æ¡†
            document.getElementById('status-permanent').addEventListener('change', (e) => {
                const statusDurationInput = document.getElementById('status-duration');
                if (e.target.checked) {
                    statusDurationInput.disabled = true;
                    statusDurationInput.classList.add('opacity-50');
                    statusDurationInput.required = false;
                } else {
                    statusDurationInput.disabled = false;
                    statusDurationInput.classList.remove('opacity-50');
                    statusDurationInput.required = true;
                }
                updatePreview();
            });
            
            // å±‚æ•°æ°¸ä¹…å­˜åœ¨å¤é€‰æ¡†
            document.getElementById('status-stackPermanent').addEventListener('change', (e) => {
                const stackDurationInput = document.getElementById('status-durationPerStack');
                if (e.target.checked) {
                    stackDurationInput.disabled = true;
                    stackDurationInput.classList.add('opacity-50');
                    stackDurationInput.required = false;
                } else {
                    stackDurationInput.disabled = false;
                    stackDurationInput.classList.remove('opacity-50');
                    stackDurationInput.required = true;
                }
                updatePreview();
            });
            
            // å±‚æ•°ç³»ç»Ÿé€‰æ‹©å™¨
            document.getElementById('status-hasStacks').addEventListener('change', (e) => {
                const hasStacks = e.target.value === 'true';
                const stackGrowParams = document.getElementById('stack-grow-params');
                const maxStacksParam = document.getElementById('max-stacks-param');
                
                if (hasStacks) {
                    stackGrowParams.style.display = 'grid';
                    maxStacksParam.style.display = 'grid';
                    // æ ¹æ®æŒç»­æ—¶é—´æ¨¡å¼å†³å®šæ˜¯å¦æ˜¾ç¤ºç›¸å…³å‚æ•°
                    const mode = document.getElementById('duration-mode').value;
                    if (mode === 'stack') {
                        document.getElementById('stack-params').style.display = 'grid';
                        document.getElementById('status-durationPerStack').required = !document.getElementById('status-stackPermanent').checked;
                    }
                } else {
                    stackGrowParams.style.display = 'none';
                    maxStacksParam.style.display = 'none';
                    document.getElementById('stack-params').style.display = 'none';
                    document.getElementById('status-durationPerStack').required = false;
                }
                updatePreview();
            });
            
            // å±‚æ•°è‡ªå¢é•¿å¤é€‰æ¡†
            document.getElementById('status-autoGrow').addEventListener('change', (e) => {
                const growRateContainer = document.getElementById('grow-rate-container');
                if (e.target.value === 'true') {
                    growRateContainer.style.display = 'block';
                } else {
                    growRateContainer.style.display = 'none';
                }
                updatePreview();
            });

            // å›¾æ ‡ä¸Šä¼ 
            document.getElementById('icon-upload').onchange = handleIconUpload;
            document.getElementById('clear-icon-btn').onclick = clearIcon;

            // è¡¨å•æäº¤
            form.onsubmit = (e) => {
                e.preventDefault();
                if (editingIndex >= 0) {
                    updateStatus();
                } else {
                    createStatus();
                }
            };

            // æ¸…ç©ºæŒ‰é’®
            document.getElementById('clear-btn').onclick = () => {
                form.reset();
                clearIcon();
                cancelEdit();
                effectValues.innerHTML = '<p class="text-xs text-gray-500">é€‰æ‹©çŠ¶æ€æ•ˆæœåï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå¯¹åº”çš„æ•°å€¼é…ç½®</p>';
                updatePreview();
            };

            // å–æ¶ˆç¼–è¾‘æŒ‰é’®
            document.getElementById('cancel-edit-btn').onclick = () => {
                form.reset();
                clearIcon();
                cancelEdit();
                effectValues.innerHTML = '<p class="text-xs text-gray-500">é€‰æ‹©çŠ¶æ€æ•ˆæœåï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå¯¹åº”çš„æ•°å€¼é…ç½®</p>';
                updatePreview();
            };

            // å¯¼å…¥å¯¼å‡º
            document.getElementById('export-btn').onclick = exportStatuses;
            document.getElementById('import-file').onchange = importStatuses;
        }
        
        // å¤„ç†å›¾æ ‡ä¸Šä¼ 
        function handleIconUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼');
                return;
            }
            
            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º 500KBï¼‰
            if (file.size > 500 * 1024) {
                alert('å›¾ç‰‡æ–‡ä»¶è¿‡å¤§ï¼è¯·ä¸Šä¼ å°äº 500KB çš„å›¾ç‰‡ï¼Œæˆ–ä½¿ç”¨å›¾ç‰‡å‹ç¼©å·¥å…·å‹ç¼©åå†ä¸Šä¼ ã€‚');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    // å‹ç¼©å›¾ç‰‡åˆ°åˆé€‚å°ºå¯¸
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // é™åˆ¶æœ€å¤§å°ºå¯¸ä¸º 64x64
                    const maxSize = 64;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > height) {
                        if (width > maxSize) {
                            height *= maxSize / width;
                            width = maxSize;
                        }
                    } else {
                        if (height > maxSize) {
                            width *= maxSize / height;
                            height = maxSize;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // è½¬æ¢ä¸º base64ï¼Œè´¨é‡è®¾ä¸º 0.8
                    iconImageData = canvas.toDataURL('image/jpeg', 0.8);
                    
                    // æ˜¾ç¤ºé¢„è§ˆ
                    const preview = document.getElementById('icon-preview');
                    const previewImg = document.getElementById('icon-preview-img');
                    previewImg.src = iconImageData;
                    preview.classList.remove('hidden');
                    
                    // æ›´æ–°ä¸»é¢„è§ˆ
                    updatePreview();
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // æ¸…é™¤å›¾æ ‡
        function clearIcon() {
            iconImageData = null;
            document.getElementById('icon-preview').classList.add('hidden');
            document.getElementById('icon-upload').value = '';
            updatePreview();
        }

        // ç”Ÿæˆæ•ˆæœæ¥æºé€‰æ‹©å™¨HTML
        function getSourceSelectHTML(effectKey) {
            return `
                <select id="source-${effectKey}" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white text-sm">
                    <optgroup label="æ–½åŠ è€…å±æ€§">
                        <option value="caster-current-attack">æ–½åŠ è€…å½“å‰æ”»å‡»åŠ›</option>
                        <option value="caster-base-attack">æ–½åŠ è€…åŸºç¡€æ”»å‡»åŠ›</option>
                        <option value="caster-current-defense">æ–½åŠ è€…å½“å‰é˜²å¾¡åŠ›</option>
                        <option value="caster-base-defense">æ–½åŠ è€…åŸºç¡€é˜²å¾¡åŠ›</option>
                        <option value="caster-current-agility">æ–½åŠ è€…å½“å‰æ•æ·</option>
                        <option value="caster-base-agility">æ–½åŠ è€…åŸºç¡€æ•æ·</option>
                        <option value="caster-max-hp">æ–½åŠ è€…æœ€å¤§ç”Ÿå‘½</option>
                    </optgroup>
                    <optgroup label="æ‰¿å—è€…å±æ€§">
                        <option value="target-current-attack">æ‰¿å—è€…å½“å‰æ”»å‡»åŠ›</option>
                        <option value="target-base-attack">æ‰¿å—è€…åŸºç¡€æ”»å‡»åŠ›</option>
                        <option value="target-current-defense">æ‰¿å—è€…å½“å‰é˜²å¾¡åŠ›</option>
                        <option value="target-base-defense">æ‰¿å—è€…åŸºç¡€é˜²å¾¡åŠ›</option>
                        <option value="target-current-agility">æ‰¿å—è€…å½“å‰æ•æ·</option>
                        <option value="target-base-agility">æ‰¿å—è€…åŸºç¡€æ•æ·</option>
                        <option value="target-max-hp" selected>æ‰¿å—è€…æœ€å¤§ç”Ÿå‘½</option>
                        <option value="target-current-hp">æ‰¿å—è€…å½“å‰ç”Ÿå‘½</option>
                        <option value="target-lost-hp">æ‰¿å—è€…å·²æŸå¤±ç”Ÿå‘½</option>
                    </optgroup>
                </select>
            `;
        }

        // æ›´æ–°æ•ˆæœå€¼é…ç½®ç•Œé¢
        function updateEffectValues() {
            const selectedEffects = Array.from(document.querySelectorAll('.effect-checkbox:checked'))
                .map(cb => cb.dataset.effect);
            
            if (selectedEffects.length === 0) {
                effectValues.innerHTML = '<p class="text-xs text-gray-500">é€‰æ‹©çŠ¶æ€æ•ˆæœåï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå¯¹åº”çš„æ•°å€¼é…ç½®</p>';
                return;
            }

            const html = selectedEffects.map(effect => {
                const config = EFFECT_CONFIG[effect];
                if (!config.needsSource && !config.needsValue) return '';
                
                let effectHtml = `<div class="border border-gray-600 rounded-lg p-3 bg-gray-700/30 space-y-2">
                    <div class="text-sm font-bold text-blue-300 mb-2">ğŸ“‹ ${config.name}</div>`;
                
                // å¦‚æœéœ€è¦æ•ˆæœæ¥æº
                if (config.needsSource) {
                    effectHtml += `
                        <div>
                            <label class="block text-xs text-gray-400 mb-1">âš¡ æ•ˆæœæ¥æº</label>
                            ${getSourceSelectHTML(effect)}
                            <p class="text-xs text-gray-500 mt-1">æ•ˆæœ = æ•ˆæœæ¥æº Ã— æ•°å€¼æ¯”ä¾‹ Ã— å±‚æ•°</p>
                        </div>`;
                }
                
                // å¦‚æœéœ€è¦æ•°å€¼é…ç½®
                if (config.needsValue) {
                    effectHtml += `
                        <div>
                            <label class="block text-xs text-gray-400 mb-1">${config.label}</label>
                            <input type="number" id="value-${effect}"
                                   value="${config.defaultValue}"
                                   min="${config.min || 0}"
                                   max="${config.max || 999}"
                                   step="${config.step || 0.01}"
                                   class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-1 text-white text-sm">
                        </div>`;
                }
                
                effectHtml += `</div>`;
                return effectHtml;
            }).filter(h => h).join('');

            effectValues.innerHTML = html || '<p class="text-xs text-gray-500">æ‰€é€‰æ•ˆæœæ— éœ€é…ç½®æ•°å€¼</p>';
            
            // ä¸ºæ–°ç”Ÿæˆçš„è¾“å…¥æ¡†å’Œé€‰æ‹©å™¨æ·»åŠ äº‹ä»¶ç›‘å¬
            effectValues.querySelectorAll('input, select').forEach(input => {
                input.addEventListener('input', updatePreview);
                input.addEventListener('change', updatePreview);
            });
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const name = document.getElementById('status-name').value;
            const description = document.getElementById('status-description').value;
            const durationMode = document.getElementById('duration-mode').value;
            const hasStacks = document.getElementById('status-hasStacks').value === 'true';
            const canPurify = document.getElementById('status-canPurify').value === 'true';
            const uniqueEffect = document.getElementById('status-uniqueEffect').value === 'true';
            const autoGrow = document.getElementById('status-autoGrow').value === 'true';
            const growRate = autoGrow ? document.getElementById('status-growRate').value : 0;

            if (!name) {
                preview.innerHTML = `
                    <div class="text-center text-gray-500">
                        <div class="text-4xl mb-2">â“</div>
                        <div class="text-sm">å¡«å†™è¡¨å•æŸ¥çœ‹é¢„è§ˆ</div>
                    </div>`;
                return;
            }

            const selectedEffects = Array.from(document.querySelectorAll('.effect-checkbox:checked'))
                .map(cb => cb.dataset.effect);

            const effectLabels = selectedEffects.map(effect =>
                `<span class="bg-purple-600/30 text-purple-300 px-2 py-1 rounded text-xs">${EFFECT_CONFIG[effect].name}</span>`
            ).join(' ');

            // å›¾æ ‡æ˜¾ç¤ºï¼šä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡
            let iconDisplay = '';
            if (iconImageData) {
                iconDisplay = `<img src="${iconImageData}" class="w-12 h-12 object-contain flex-shrink-0">`;
            } else {
                iconDisplay = `<div class="w-12 h-12 bg-gray-700 rounded flex items-center justify-center text-2xl flex-shrink-0">â“</div>`;
            }
            
            // æŒç»­æ—¶é—´æ˜¾ç¤ºï¼ˆæ ¹æ®æ¨¡å¼åªæ˜¾ç¤ºä¸€ç§ï¼‰
            let durationText = '';
            if (durationMode === 'status') {
                // çŠ¶æ€æ•´ä½“æŒç»­æ¨¡å¼
                const isPermanent = document.getElementById('status-permanent').checked;
                const statusDuration = document.getElementById('status-duration').value;
                durationText = isPermanent ? 'çŠ¶æ€æ°¸ä¹…' : `çŠ¶æ€${statusDuration}å›åˆ`;
            } else {
                // æ¯å±‚ç‹¬ç«‹è®¡æ—¶æ¨¡å¼
                const isStackPermanent = document.getElementById('status-stackPermanent').checked;
                const durationPerStack = document.getElementById('status-durationPerStack').value;
                durationText = hasStacks ? (isStackPermanent ? 'å±‚æ•°æ°¸ä¹…' : `æ¯å±‚${durationPerStack}å›åˆ`) : 'æ— å±‚æ•°';
            }
            
            const maxStacks = document.getElementById('status-maxStacks').value;

            preview.innerHTML = `
                <div class="flex items-start gap-3">
                    ${iconDisplay}
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-2">
                            <h4 class="text-lg font-bold text-white">${name}</h4>
                            ${canPurify ? '<span class="text-xs bg-green-600/30 text-green-300 px-2 py-0.5 rounded">å¯å‡€åŒ–</span>' : '<span class="text-xs bg-red-600/30 text-red-300 px-2 py-0.5 rounded">ä¸å¯å‡€åŒ–</span>'}
                        </div>
                        ${description ? `<p class="text-xs text-gray-400 italic mb-2">${description}</p>` : ''}
                        ${effectLabels ? `<div class="flex flex-wrap gap-1 mb-2">${effectLabels}</div>` : ''}
                        <div class="flex flex-wrap gap-2 text-xs">
                            <span class="bg-blue-600/30 text-blue-300 px-2 py-1 rounded">${durationText}</span>
                            ${hasStacks && maxStacks > 1 ? `<span class="bg-yellow-600/30 text-yellow-300 px-2 py-1 rounded">æœ€å¤š${maxStacks}å±‚</span>` : ''}
                            ${uniqueEffect ? `<span class="bg-purple-600/30 text-purple-300 px-2 py-1 rounded">å”¯ä¸€æ•ˆæœ</span>` : ''}
                            ${hasStacks && autoGrow ? `<span class="bg-cyan-600/30 text-cyan-300 px-2 py-1 rounded">æ¯å›åˆ+${growRate}å±‚</span>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // è·å–è¡¨å•æ•°æ®
        function getFormData() {
            const selectedEffects = Array.from(document.querySelectorAll('.effect-checkbox:checked'))
                .map(cb => cb.dataset.effect);
            
            const effectConfigs = {};
            selectedEffects.forEach(effect => {
                const config = EFFECT_CONFIG[effect];
                const effectData = {};
                
                // å¦‚æœéœ€è¦æ•ˆæœæ¥æº
                if (config.needsSource) {
                    const sourceSelect = document.getElementById(`source-${effect}`);
                    effectData.source = sourceSelect ? sourceSelect.value : 'target-max-hp';
                }
                
                // å¦‚æœéœ€è¦æ•°å€¼é…ç½®
                if (config.needsValue) {
                    const valueInput = document.getElementById(`value-${effect}`);
                    effectData.value = valueInput ? parseFloat(valueInput.value) : config.defaultValue;
                }
                
                effectConfigs[effect] = effectData;
            });

            const durationMode = document.getElementById('duration-mode').value;
            const hasStacks = document.getElementById('status-hasStacks').value === 'true';
            const autoGrow = hasStacks ? (document.getElementById('status-autoGrow').value === 'true') : false;
            
            // æ ¹æ®æ¨¡å¼å†³å®šä½¿ç”¨å“ªç§æŒç»­æ—¶é—´
            let isPermanent, statusDuration, isStackPermanent, durationPerStack;
            
            if (durationMode === 'status') {
                // çŠ¶æ€æ•´ä½“æŒç»­æ¨¡å¼
                isPermanent = document.getElementById('status-permanent').checked;
                statusDuration = parseInt(document.getElementById('status-duration').value) || 10;
                isStackPermanent = true; // å±‚æ•°æ°¸ä¹…
                durationPerStack = 999; // ä¸ä½¿ç”¨
            } else {
                // æ¯å±‚ç‹¬ç«‹è®¡æ—¶æ¨¡å¼
                isPermanent = true; // çŠ¶æ€æ°¸ä¹…
                statusDuration = 999; // ä¸ä½¿ç”¨
                isStackPermanent = document.getElementById('status-stackPermanent').checked;
                durationPerStack = hasStacks ? parseInt(document.getElementById('status-durationPerStack').value) || 3 : 0;
            }
            
            return {
                name: document.getElementById('status-name').value,
                iconImage: iconImageData,
                description: document.getElementById('status-description').value,
                statusDuration: statusDuration,
                hasStacks: hasStacks,
                durationPerStack: durationPerStack,
                isPermanent: isPermanent,
                isStackPermanent: isStackPermanent,
                maxStacks: hasStacks ? parseInt(document.getElementById('status-maxStacks').value) : 1,
                canPurify: document.getElementById('status-canPurify').value === 'true',
                uniqueEffect: document.getElementById('status-uniqueEffect').value === 'true',
                autoGrow: autoGrow,
                growRate: autoGrow ? parseInt(document.getElementById('status-growRate').value) : 0,
                effects: selectedEffects,
                effectConfigs: effectConfigs
            };
        }

        // åˆ›å»ºçŠ¶æ€
        function createStatus() {
            const data = getFormData();
            
            if (data.effects.length === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªçŠ¶æ€æ•ˆæœï¼');
                return;
            }
            
            if (!data.iconImage) {
                alert('è¯·ä¸Šä¼ çŠ¶æ€å›¾æ ‡å›¾ç‰‡ï¼');
                return;
            }

            const statusKey = `STATUS_${Date.now()}`;
            const status = {
                key: statusKey,
                ...data,
                createdAt: new Date().toISOString()
            };

            statuses.push(status);
            saveStatusPool();
            
            renderStatusList();
            updateStatusCount();
            form.reset();
            clearIcon();
            effectValues.innerHTML = '<p class="text-xs text-gray-500">é€‰æ‹©çŠ¶æ€æ•ˆæœåï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå¯¹åº”çš„æ•°å€¼é…ç½®</p>';
            updatePreview();
            
            alert(`âœ… çŠ¶æ€ "${data.name}" å·²åˆ›å»ºï¼`);
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus() {
            const data = getFormData();
            
            if (data.effects.length === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªçŠ¶æ€æ•ˆæœï¼');
                return;
            }
            
            if (!data.iconImage) {
                alert('è¯·ä¸Šä¼ çŠ¶æ€å›¾æ ‡å›¾ç‰‡ï¼');
                return;
            }
            
            const status = {
                key: statuses[editingIndex].key,
                ...data,
                createdAt: statuses[editingIndex].createdAt,
                updatedAt: new Date().toISOString()
            };

            statuses[editingIndex] = status;
            saveStatusPool();
            
            renderStatusList();
            form.reset();
            clearIcon();
            cancelEdit();
            effectValues.innerHTML = '<p class="text-xs text-gray-500">é€‰æ‹©çŠ¶æ€æ•ˆæœåï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå¯¹åº”çš„æ•°å€¼é…ç½®</p>';
            updatePreview();
            
            alert(`âœ… çŠ¶æ€ "${data.name}" å·²æ›´æ–°ï¼`);
        }

        // ç¼–è¾‘çŠ¶æ€
        function editStatus(index) {
            const status = statuses[index];
            editingIndex = index;
            
            // å¡«å……åŸºæœ¬ä¿¡æ¯
            document.getElementById('status-name').value = status.name;
            document.getElementById('status-description').value = status.description || '';
            document.getElementById('status-canPurify').value = status.canPurify ? 'true' : 'false';
            document.getElementById('status-uniqueEffect').value = status.uniqueEffect ? 'true' : 'false';
            
            // å¤„ç†å±‚æ•°ç³»ç»Ÿ
            const hasStacks = status.hasStacks !== false; // é»˜è®¤ä¸ºtrueä»¥å…¼å®¹æ—§æ•°æ®
            document.getElementById('status-hasStacks').value = hasStacks ? 'true' : 'false';
            const stackGrowParams = document.getElementById('stack-grow-params');
            if (hasStacks) {
                stackGrowParams.style.display = 'grid';
                document.getElementById('status-maxStacks').value = status.maxStacks || 1;
            } else {
                stackGrowParams.style.display = 'none';
            }
            
            // åˆ¤æ–­æŒç»­æ—¶é—´æ¨¡å¼ï¼ˆæ ¹æ®isPermanentå’ŒisStackPermanentåˆ¤æ–­ï¼‰
            let durationMode = 'status'; // é»˜è®¤çŠ¶æ€æ•´ä½“æŒç»­
            if (status.isPermanent && !status.isStackPermanent) {
                durationMode = 'stack'; // æ¯å±‚ç‹¬ç«‹è®¡æ—¶
            }
            document.getElementById('duration-mode').value = durationMode;
            
            // æ ¹æ®æ¨¡å¼æ˜¾ç¤ºå¯¹åº”çš„é…ç½®
            const statusDurationParams = document.getElementById('status-duration-params');
            const stackParams = document.getElementById('stack-params');
            
            if (durationMode === 'status') {
                statusDurationParams.style.display = 'grid';
                stackParams.style.display = 'none';
                
                document.getElementById('status-duration').value = status.statusDuration || 10;
                document.getElementById('status-permanent').checked = status.isPermanent;
                const statusDurationInput = document.getElementById('status-duration');
                if (status.isPermanent) {
                    statusDurationInput.disabled = true;
                    statusDurationInput.classList.add('opacity-50');
                    statusDurationInput.required = false;
                } else {
                    statusDurationInput.disabled = false;
                    statusDurationInput.classList.remove('opacity-50');
                    statusDurationInput.required = true;
                }
            } else {
                statusDurationParams.style.display = 'none';
                stackParams.style.display = 'grid';
                
                document.getElementById('status-durationPerStack').value = status.durationPerStack || 3;
                document.getElementById('status-stackPermanent').checked = status.isStackPermanent;
                const stackDurationInput = document.getElementById('status-durationPerStack');
                if (status.isStackPermanent) {
                    stackDurationInput.disabled = true;
                    stackDurationInput.classList.add('opacity-50');
                    stackDurationInput.required = false;
                } else {
                    stackDurationInput.disabled = false;
                    stackDurationInput.classList.remove('opacity-50');
                    stackDurationInput.required = true;
                }
            }
            
            // å¤„ç†å±‚æ•°è‡ªå¢é•¿
            document.getElementById('status-autoGrow').value = status.autoGrow ? 'true' : 'false';
            const growRateContainer = document.getElementById('grow-rate-container');
            if (status.autoGrow) {
                growRateContainer.style.display = 'block';
                document.getElementById('status-growRate').value = status.growRate || 1;
            } else {
                growRateContainer.style.display = 'none';
            }
            
            // è®¾ç½®å›¾æ ‡
            if (status.iconImage) {
                iconImageData = status.iconImage;
                const iconPreview = document.getElementById('icon-preview');
                const previewImg = document.getElementById('icon-preview-img');
                previewImg.src = iconImageData;
                iconPreview.classList.remove('hidden');
            }
            
            // é€‰ä¸­æ•ˆæœå¤é€‰æ¡†
            document.querySelectorAll('.effect-checkbox').forEach(cb => cb.checked = false);
            status.effects.forEach(effect => {
                const checkbox = document.querySelector(`.effect-checkbox[data-effect="${effect}"]`);
                if (checkbox) checkbox.checked = true;
            });
            
            // æ›´æ–°æ•ˆæœå€¼é…ç½®
            updateEffectValues();
            
            // å¡«å……æ•ˆæœé…ç½®å€¼
            setTimeout(() => {
                status.effects.forEach(effect => {
                    const config = status.effectConfigs?.[effect];
                    if (config) {
                        if (config.source) {
                            const sourceSelect = document.getElementById(`source-${effect}`);
                            if (sourceSelect) sourceSelect.value = config.source;
                        }
                        if (config.value !== undefined) {
                            const valueInput = document.getElementById(`value-${effect}`);
                            if (valueInput) valueInput.value = config.value;
                        }
                    }
                });
                updatePreview();
            }, 100);
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('submit-text').textContent = 'ğŸ’¾ æ›´æ–°çŠ¶æ€';
            document.getElementById('submit-btn').classList.remove('bg-blue-600', 'hover:bg-blue-700');
            document.getElementById('submit-btn').classList.add('bg-green-600', 'hover:bg-green-700');
            document.getElementById('cancel-edit-btn').classList.remove('hidden');
            
            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // å–æ¶ˆç¼–è¾‘
        function cancelEdit() {
            editingIndex = -1;
            document.getElementById('submit-text').textContent = 'âœ¨ åˆ›å»ºçŠ¶æ€';
            document.getElementById('submit-btn').classList.remove('bg-green-600', 'hover:bg-green-700');
            document.getElementById('submit-btn').classList.add('bg-blue-600', 'hover:bg-blue-700');
            document.getElementById('cancel-edit-btn').classList.add('hidden');
        }

        // ä¿å­˜çŠ¶æ€æ± 
        function saveStatusPool() {
            try {
                localStorage.setItem('STATUS_POOL', JSON.stringify(statuses));
            } catch (e) {
                if (e.name === 'QuotaExceededError') {
                    alert('âŒ å­˜å‚¨ç©ºé—´ä¸è¶³ï¼å›¾ç‰‡å ç”¨ç©ºé—´è¿‡å¤§ï¼Œè¯·ï¼š\n1. åˆ é™¤ä¸€äº›ä¸éœ€è¦çš„çŠ¶æ€\n2. ä½¿ç”¨æ›´å°çš„å›¾ç‰‡ï¼ˆå»ºè®® < 500KBï¼‰\n3. å¯¼å‡ºå¤‡ä»½åæ¸…ç©ºçŠ¶æ€æ± ');
                } else {
                    alert('âŒ ä¿å­˜å¤±è´¥ï¼š' + e.message);
                }
                throw e;
            }
        }

        // æ¸²æŸ“çŠ¶æ€åˆ—è¡¨
        function renderStatusList() {
            if (statuses.length === 0) {
                statusList.innerHTML = '<div class="text-center text-gray-500 text-sm py-8">æš‚æ— çŠ¶æ€</div>';
                return;
            }

            statusList.innerHTML = statuses.map((status, index) => {
                const effectLabels = status.effects.map(effect =>
                    `<span class="bg-purple-600/30 text-purple-300 px-1.5 py-0.5 rounded text-xs">${EFFECT_CONFIG[effect]?.name || effect}</span>`
                ).join(' ');
                
                // å›¾æ ‡æ˜¾ç¤ºï¼šåªä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡
                let iconDisplay = '';
                if (status.iconImage) {
                    iconDisplay = `<img src="${status.iconImage}" class="w-10 h-10 object-contain flex-shrink-0">`;
                } else {
                    iconDisplay = `<div class="w-10 h-10 bg-gray-700 rounded flex items-center justify-center text-lg flex-shrink-0">â“</div>`;
                }
                
                return `
                    <div class="status-card bg-gray-800 rounded-lg p-3 border border-gray-600">
                        <div class="flex items-start gap-2">
                            ${iconDisplay}
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-1">
                                    <h5 class="text-sm font-bold text-white truncate">${status.name}</h5>
                                    ${status.canPurify ? '<span class="text-xs bg-green-600/30 text-green-300 px-1.5 py-0.5 rounded flex-shrink-0">å¯å‡€åŒ–</span>' : '<span class="text-xs bg-red-600/30 text-red-300 px-1.5 py-0.5 rounded flex-shrink-0">ä¸å¯å‡€åŒ–</span>'}
                                </div>
                                ${status.description ? `<p class="text-xs text-gray-500 italic mb-1 line-clamp-2">${status.description}</p>` : ''}
                                <div class="text-xs text-gray-400 mb-1">
                                    ${status.isPermanent && status.isStackPermanent ?
                                        'çŠ¶æ€æ°¸ä¹… Â· å±‚æ•°æ°¸ä¹…' :
                                        (status.isPermanent ?
                                            (status.hasStacks === false ? 'æ— å±‚æ•°' : `æ¯å±‚${status.durationPerStack || 3}å›åˆ`) :
                                            (status.isStackPermanent ?
                                                `çŠ¶æ€${status.statusDuration || 10}å›åˆ` :
                                                `çŠ¶æ€${status.statusDuration || 10}å›åˆ Â· æ¯å±‚${status.durationPerStack || 3}å›åˆ`))} ${status.hasStacks !== false && status.maxStacks > 1 ? `Â· æœ€å¤š${status.maxStacks}å±‚` : ''} ${status.uniqueEffect ? 'Â· å”¯ä¸€æ•ˆæœ' : ''} ${status.hasStacks !== false && status.autoGrow ? `Â· æ¯å›åˆ+${status.growRate}å±‚` : ''}
                                </div>
                                ${effectLabels ? `<div class="flex flex-wrap gap-1">${effectLabels}</div>` : ''}
                            </div>
                            <div class="flex gap-1 flex-shrink-0">
                                <button onclick="editStatus(${index})"
                                    class="text-blue-400 hover:text-blue-300 text-lg px-2" title="ç¼–è¾‘">âœï¸</button>
                                <button onclick="deleteStatus(${index})"
                                    class="text-red-400 hover:text-red-300 text-xl" title="åˆ é™¤">Ã—</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åˆ é™¤çŠ¶æ€
        function deleteStatus(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªçŠ¶æ€å—ï¼Ÿ')) {
                statuses.splice(index, 1);
                saveStatusPool();
                renderStatusList();
                updateStatusCount();
            }
        }

        // æ›´æ–°çŠ¶æ€æ•°é‡
        function updateStatusCount() {
            statusCount.textContent = statuses.length;
        }

        // å¯¼å‡ºçŠ¶æ€æ± 
        function exportStatuses() {
            if (statuses.length === 0) {
                alert('çŠ¶æ€æ± ä¸ºç©ºï¼');
                return;
            }

            const dataStr = JSON.stringify(statuses, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `status_pool_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // å¯¼å…¥çŠ¶æ€
        function importStatuses(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const importedStatuses = JSON.parse(event.target.result);
                    
                    if (!Array.isArray(importedStatuses)) {
                        alert('âŒ æ— æ•ˆçš„JSONæ ¼å¼ï¼');
                        return;
                    }

                    const existingKeys = new Set(statuses.map(s => s.key));
                    const newStatuses = importedStatuses.filter(s => !existingKeys.has(s.key));
                    
                    statuses = [...statuses, ...newStatuses];
                    saveStatusPool();
                    
                    renderStatusList();
                    updateStatusCount();
                    alert(`âœ… æˆåŠŸå¯¼å…¥ ${newStatuses.length} ä¸ªæ–°çŠ¶æ€ï¼`);
                } catch (error) {
                    alert('âŒ å¯¼å…¥å¤±è´¥ï¼š' + error.message);
                }
            };
            reader.readAsText(file);
            
            e.target.value = '';
        }

        // åˆå§‹åŒ–åº”ç”¨
        init();
    </script>
</body>
</html>