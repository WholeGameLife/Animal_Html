
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨ç‰©è®¾è®¡å™¨ - ç”µå­ç›†æ ½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #065f46 0%, #064e3b 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        
        .animal-card {
            transition: all 0.3s ease;
        }
        
        .animal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        /* ç³»åˆ«é¢œè‰² */
        .element-water { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .element-fire { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .element-grass { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .element-wind { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .element-electric { background: linear-gradient(135deg, #eab308, #ca8a04); }
        .element-earth { background: linear-gradient(135deg, #a16207, #854d0e); }
        
        /* ç¨€æœ‰åº¦é¢œè‰² */
        .rarity-common { background: linear-gradient(135deg, #6b7280, #4b5563); }
        .rarity-shiny { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
        .rarity-prismatic { background: linear-gradient(135deg, #ec4899, #8b5cf6, #3b82f6); }
        .rarity-stellar { background: linear-gradient(135deg, #fef3c7, #fde68a, #fbbf24); color: #92400e; }
        
        .color-preview {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-7xl mx-auto">
        <!-- æ ‡é¢˜ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">ğŸ¦ åŠ¨ç‰©è®¾è®¡å™¨ ğŸ¦</h1>
            <p class="text-green-200">è®¾è®¡å’Œç®¡ç†åŠ¨ç‰©æ¨¡æ¿æ± </p>
            <div class="mt-4 bg-green-900/50 border border-green-700 rounded-lg p-4 max-w-3xl mx-auto text-left">
                <p class="text-sm text-green-200 font-bold mb-2">ğŸ’¡ åŠ¨ç‰©ç”Ÿæˆæœºåˆ¶ï¼š</p>
                <div class="text-xs text-green-100">
                    <div class="mb-2">â€¢ æ¸¸æˆä¼šä»åŠ¨ç‰©æ¨¡æ¿æ± ä¸­éšæœºé€‰æ‹©æ¨¡æ¿ç”Ÿæˆé‡ç”ŸåŠ¨ç‰©</div>
                    <div class="mb-2">â€¢ æ¯ä¸ªæ¨¡æ¿å®šä¹‰äº†åŠ¨ç‰©çš„åŸºç¡€å±æ€§ã€ç³»åˆ«ã€ç¨€æœ‰åº¦ç­‰</div>
                    <div>â€¢ ç”Ÿæˆçš„åŠ¨ç‰©ä¼šåœ¨æ¨¡æ¿åŸºç¡€ä¸Šæ·»åŠ éšæœºå˜åŒ–</div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- å·¦ä¾§ï¼šåŠ¨ç‰©è®¾è®¡è¡¨å• -->
            <div class="lg:col-span-2 bg-gray-900/80 backdrop-blur-lg rounded-xl p-6 border border-gray-700">
                <h2 class="text-2xl font-bold text-white mb-6">ğŸ¨ åˆ›å»ºåŠ¨ç‰©æ¨¡æ¿</h2>
                
                <form id="animal-form" class="space-y-4">
                    <!-- åŸºç¡€ä¿¡æ¯ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">åŠ¨ç‰©åç§° *</label>
                        <input type="text" id="animal-name" required
                            class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-green-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">åŠ¨ç‰©ID (ç‰©ç§+ç¨€æœ‰åº¦) *</label>
                        <input type="text" id="animal-id" required pattern="^[1-4]\d{4}$"
                            class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white font-mono text-center text-lg focus:outline-none focus:border-green-500"
                            placeholder="ä¾‹: 10001">
                        <p class="text-xs text-gray-400 mt-1">
                            æ ¼å¼ï¼š<span class="font-mono">1xxxx</span>=æ™®é€š <span class="font-mono">2xxxx</span>=é—ªå…‰
                            <span class="font-mono">3xxxx</span>=å¹»å½© <span class="font-mono">4xxxx</span>=æ˜ŸèŠ’<br>
                            ä¾‹ï¼š10001(æ™®é€š)ã€20001(é—ªå…‰)ã€30001(å¹»å½©)ã€40001(æ˜ŸèŠ’)ä¸ºåŒä¸€ç‰©ç§
                        </p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-300 mb-2">é¢œè‰² (åå…­è¿›åˆ¶)</label>
                            <div class="flex gap-2">
                                <input type="color" id="animal-color" required
                                    class="w-16 h-10 bg-gray-800 border border-gray-600 rounded-lg cursor-pointer">
                                <input type="text" id="animal-color-hex" required pattern="^#[0-9A-Fa-f]{6}$"
                                    class="flex-1 bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-green-500"
                                    placeholder="#FF5733">
                            </div>
                        </div>
                        
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-300 mb-2">å¤´åƒå›¾ç‰‡ (å¯é€‰)</label>
                            <div class="flex gap-2">
                                <label for="animal-avatar-input" class="flex-1 bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-gray-400 hover:border-purple-500 cursor-pointer transition-colors flex items-center justify-center">
                                    <span id="avatar-filename">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡</span>
                                </label>
                                <input type="file" id="animal-avatar-input" accept="image/*" class="hidden">
                                <button type="button" id="clear-avatar-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 rounded-lg hidden">
                                    æ¸…é™¤
                                </button>
                            </div>
                            <div id="avatar-preview" class="mt-2 hidden">
                                <img id="avatar-preview-img" class="w-20 h-20 rounded-full border-2 border-gray-600 object-cover" alt="å¤´åƒé¢„è§ˆ">
                            </div>
                            <p class="text-xs text-gray-400 mt-1">æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼ï¼Œå»ºè®®å°ºå¯¸ 200x200</p>
                        </div>
                    </div>

                    <!-- ç³»åˆ«å’Œç¨€æœ‰åº¦ -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">ç³»åˆ«</label>
                            <select id="animal-element" required
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-green-500">
                                <option value="">é€‰æ‹©ç³»åˆ«</option>
                                <option value="water">ğŸ’§ æ°´ç³»</option>
                                <option value="fire">ğŸ”¥ ç«ç³»</option>
                                <option value="grass">ğŸŒ¿ è‰ç³»</option>
                                <option value="wind">ğŸ’¨ é£ç³»</option>
                                <option value="electric">âš¡ ç”µç³»</option>
                                <option value="earth">ğŸª¨ åœŸç³»</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">ç¨€æœ‰åº¦</label>
                            <select id="animal-rarity" required
                                class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-green-500">
                                <option value="">é€‰æ‹©ç¨€æœ‰åº¦</option>
                                <option value="common">âšª æ™®é€š</option>
                                <option value="shiny">âœ¨ é—ªå…‰</option>
                                <option value="prismatic">ğŸŒˆ å¹»å½©</option>
                                <option value="stellar">â­ æ˜ŸèŠ’</option>
                            </select>
                        </div>
                    </div>

                    <!-- åŸºç¡€å±æ€§ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">ğŸ“Š åŸºç¡€å±æ€§</label>
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="text-xs text-gray-400">åˆå§‹ç­‰çº§</label>
                                <input type="number" id="animal-level" min="1" max="100" value="1" required
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-green-500">
                            </div>
                            <div>
                                <label class="text-xs text-gray-400">åŸºç¡€ç»éªŒå€¼</label>
                                <input type="number" id="animal-base-exp" min="10" max="1000" value="100" required
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-green-500">
                                <p class="text-xs text-gray-500 mt-1">Lv1â†’Lv2æ‰€éœ€ç»éªŒ</p>
                            </div>
                            <div>
                                <label class="text-xs text-gray-400">ç»éªŒå¢é•¿ç³»æ•°</label>
                                <input type="number" id="animal-exp-growth" min="1.0" max="2.0" step="0.1" value="1.2" required
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-green-500">
                                <p class="text-xs text-gray-500 mt-1">æ¯çº§ç»éªŒå€ç‡</p>
                            </div>
                            <div>
                                <label class="text-xs text-gray-400">ç”Ÿå‘½å€¼</label>
                                <input type="number" id="animal-health" min="50" max="1000" value="100" required
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-green-500">
                            </div>
                            <div>
                                <label class="text-xs text-gray-400">ä½“åŠ›</label>
                                <input type="number" id="animal-stamina" min="50" max="500" value="100" required
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-green-500">
                            </div>
                            <div>
                                <label class="text-xs text-gray-400">å¥½æ„Ÿåº¦</label>
                                <input type="number" id="animal-favorability" min="0" max="100" value="50" required
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-green-500">
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">ğŸ’¡ å‡çº§ç»éªŒå…¬å¼ï¼šLv Nâ†’N+1 = åŸºç¡€ç»éªŒ Ã— (å¢é•¿ç³»æ•° ^ (N-1))</p>
                    </div>

                    <!-- æˆ˜æ–—èƒ½åŠ› -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">âš”ï¸ æˆ˜æ–—èƒ½åŠ›</label>
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="text-xs text-gray-400">æ”»å‡»</label>
                                <input type="number" id="animal-attack" min="5" max="100" value="10" required
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-green-500">
                            </div>
                            <div>
                                <label class="text-xs text-gray-400">é˜²å¾¡</label>
                                <input type="number" id="animal-defense" min="5" max="100" value="5" required
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-green-500">
                            </div>
                            <div>
                                <label class="text-xs text-gray-400">æ•æ·</label>
                                <input type="number" id="animal-agility" min="5" max="100" value="8" required
                                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-green-500">
                            </div>
                        </div>
                    </div>

                    <!-- ä¸‰ç§æˆé•¿é…ç½® -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">ğŸ“ˆ æˆé•¿é…ç½® (æ¯çº§å¢é•¿)</label>
                        <p class="text-xs text-gray-400 mb-3">ğŸ’¡ é…ç½®ä¸‰ç§æˆé•¿ç±»å‹ï¼Œåœ¨åœ°å›¾ä¸­ç”Ÿæˆæ—¶é€‰æ‹©ä½¿ç”¨å“ªç§</p>
                        
                        <!-- å¹³åº¸æˆé•¿ -->
                        <div class="bg-gray-800/50 rounded-lg p-3 border border-gray-600 mb-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-sm font-bold text-gray-300">â­ å¹³åº¸æˆé•¿ (1.0x)</span>
                            </div>
                            <div class="grid grid-cols-3 gap-3">
                                <div>
                                    <label class="text-xs text-gray-400">ç”Ÿå‘½å€¼</label>
                                    <input type="number" id="growth-mediocre-health" min="1" max="100" value="10" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-green-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">ä½“åŠ›</label>
                                    <input type="number" id="growth-mediocre-stamina" min="1" max="50" value="8" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-green-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">å¥½æ„Ÿåº¦</label>
                                    <input type="number" id="growth-mediocre-favorability" min="1" max="10" value="3" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-green-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">æ”»å‡»</label>
                                    <input type="number" id="growth-mediocre-attack" min="1" max="10" value="2" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-green-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">é˜²å¾¡</label>
                                    <input type="number" id="growth-mediocre-defense" min="1" max="10" value="1" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-green-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">æ•æ·</label>
                                    <input type="number" id="growth-mediocre-agility" min="1" max="10" value="1" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-green-500">
                                </div>
                            </div>
                        </div>
                        
                        <!-- è¶…å¸¸æˆé•¿ -->
                        <div class="bg-gray-800/50 rounded-lg p-3 border border-gray-600 mb-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-sm font-bold text-blue-300">â­â­ è¶…å¸¸æˆé•¿ (1.5x)</span>
                            </div>
                            <div class="grid grid-cols-3 gap-3">
                                <div>
                                    <label class="text-xs text-gray-400">ç”Ÿå‘½å€¼</label>
                                    <input type="number" id="growth-extraordinary-health" min="1" max="100" value="15" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">ä½“åŠ›</label>
                                    <input type="number" id="growth-extraordinary-stamina" min="1" max="50" value="12" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">å¥½æ„Ÿåº¦</label>
                                    <input type="number" id="growth-extraordinary-favorability" min="1" max="10" value="5" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">æ”»å‡»</label>
                                    <input type="number" id="growth-extraordinary-attack" min="1" max="10" value="3" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">é˜²å¾¡</label>
                                    <input type="number" id="growth-extraordinary-defense" min="1" max="10" value="2" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">æ•æ·</label>
                                    <input type="number" id="growth-extraordinary-agility" min="1" max="10" value="2" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-blue-500">
                                </div>
                            </div>
                        </div>
                        
                        <!-- ç’€ç’¨æˆé•¿ -->
                        <div class="bg-gray-800/50 rounded-lg p-3 border border-gray-600">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-sm font-bold text-purple-300">â­â­â­ ç’€ç’¨æˆé•¿ (2.0x)</span>
                            </div>
                            <div class="grid grid-cols-3 gap-3">
                                <div>
                                    <label class="text-xs text-gray-400">ç”Ÿå‘½å€¼</label>
                                    <input type="number" id="growth-brilliant-health" min="1" max="100" value="20" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-purple-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">ä½“åŠ›</label>
                                    <input type="number" id="growth-brilliant-stamina" min="1" max="50" value="16" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-purple-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">å¥½æ„Ÿåº¦</label>
                                    <input type="number" id="growth-brilliant-favorability" min="1" max="10" value="7" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-purple-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">æ”»å‡»</label>
                                    <input type="number" id="growth-brilliant-attack" min="1" max="10" value="4" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-purple-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">é˜²å¾¡</label>
                                    <input type="number" id="growth-brilliant-defense" min="1" max="10" value="3" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-purple-500">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">æ•æ·</label>
                                    <input type="number" id="growth-brilliant-agility" min="1" max="10" value="3" required
                                        class="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm focus:outline-none focus:border-purple-500">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æŠ€èƒ½æ± é€‰æ‹© -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">ğŸ¯ æŠ€èƒ½æ± é€‰æ‹©</label>
                        <p class="text-xs text-gray-400 mb-3">ğŸ’¡ é€‰æ‹©ä¸€ä¸ªæŠ€èƒ½æ± ï¼ŒåŠ¨ç‰©å°†ä»ä¸­éšæœºè·å¾—æŠ€èƒ½ï¼ˆæ•°é‡ç”±æŠ€èƒ½æ§½ä½æ•°å†³å®šï¼‰</p>
                        <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-600">
                            <div class="flex gap-2 mb-3">
                                <select id="skillpool-select"
                                    class="flex-1 bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-500">
                                    <option value="">-- é€‰æ‹©æŠ€èƒ½æ±  --</option>
                                </select>
                                <a href="skillpool_designer.html" target="_blank"
                                    class="bg-purple-600 hover:bg-purple-700 text-white text-sm font-bold py-2 px-4 rounded-lg transition-colors whitespace-nowrap">
                                    âš™ï¸ ç®¡ç†æŠ€èƒ½æ± 
                                </a>
                            </div>
                            <div id="selected-skillpool-info" class="hidden bg-purple-900/30 border border-purple-600 rounded-lg p-3">
                                <!-- é€‰ä¸­çš„æŠ€èƒ½æ± ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                            </div>
                        </div>
                    </div>

                    <!-- æè¿° -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">åŠ¨ç‰©æè¿°</label>
                        <textarea id="animal-desc" rows="2"
                            class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-green-500"
                            placeholder="æè¿°è¿™ä¸ªåŠ¨ç‰©çš„ç‰¹ç‚¹..."></textarea>
                    </div>

                    <!-- æŒ‰é’® -->
                    <div class="flex gap-4 pt-4">
                        <button type="submit" id="submit-btn"
                            class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                            <span id="submit-text">âœ¨ åˆ›å»ºåŠ¨ç‰©æ¨¡æ¿</span>
                        </button>
                        <button type="button" id="cancel-edit-btn" class="hidden bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                            âŒ å–æ¶ˆç¼–è¾‘
                        </button>
                        <button type="button" id="clear-btn"
                            class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                            ğŸ”„ æ¸…ç©º
                        </button>
                    </div>
                </form>
            </div>

            <!-- å³ä¾§ï¼šåŠ¨ç‰©é¢„è§ˆå’Œåˆ—è¡¨ -->
            <div class="space-y-6">
                <!-- åŠ¨ç‰©å±æ€§é¢„è§ˆ -->
                <div class="bg-gray-900/80 backdrop-blur-lg rounded-xl p-6 border border-gray-700">
                    <h3 class="text-xl font-bold text-white mb-4">ğŸ“‹ å±æ€§é¢„è§ˆ</h3>
                    <div id="animal-preview" class="animal-card bg-gray-800 rounded-lg p-4 border-2 border-gray-600">
                        <div class="text-center text-gray-500">
                            <div class="text-4xl mb-2">â“</div>
                            <div class="text-sm">å¡«å†™è¡¨å•æŸ¥çœ‹é¢„è§ˆ</div>
                        </div>
                    </div>
                </div>

                <!-- åŠ¨ç‰©æ¨¡æ¿æ±  -->
                <div class="bg-gray-900/80 backdrop-blur-lg rounded-xl p-6 border border-gray-700">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">ğŸ¦ åŠ¨ç‰©æ¨¡æ¿æ±  (<span id="animal-count">0</span>)</h3>
                        <div class="flex gap-2">
                            <label for="import-file"
                                class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold py-2 px-4 rounded-lg transition-colors cursor-pointer">
                                ğŸ“¤ å¯¼å…¥
                            </label>
                            <input type="file" id="import-file" accept=".json" class="hidden">
                            <button id="export-btn"
                                class="bg-green-600 hover:bg-green-700 text-white text-sm font-bold py-2 px-4 rounded-lg transition-colors">
                                ğŸ“¥ å¯¼å‡ºJSON
                            </button>
                            <button id="export-csv-btn"
                                class="bg-teal-600 hover:bg-teal-700 text-white text-sm font-bold py-2 px-4 rounded-lg transition-colors">
                                ğŸ“Š å¯¼å‡ºCSV
                            </button>
                            <button id="apply-to-game-btn"
                                class="bg-purple-600 hover:bg-purple-700 text-white text-sm font-bold py-2 px-4 rounded-lg transition-colors">
                                ğŸ® åº”ç”¨
                            </button>
                        </div>
                    </div>
                    <div id="animals-list" class="space-y-3 max-h-96 overflow-y-auto">
                        <div class="text-center text-gray-500 text-sm py-8">
                            æš‚æ— åŠ¨ç‰©æ¨¡æ¿
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åŠ¨ç‰©æ¨¡æ¿æ± å­˜å‚¨
        let animals = JSON.parse(localStorage.getItem('ANIMAL_POOL') || '[]');
        // æŠ€èƒ½æ± 
        let skillPool = JSON.parse(localStorage.getItem('SKILL_POOL') || '[]');
        // å½“å‰ç¼–è¾‘çš„åŠ¨ç‰©ç´¢å¼•
        let editingIndex = -1;
        // å½“å‰é€‰æ‹©çš„å¤´åƒæ•°æ®
        let currentAvatarData = null;
        // å¤´åƒæ˜¯å¦è¢«ä¿®æ”¹è¿‡
        let avatarModified = false;

        // DOMå…ƒç´ 
        const form = document.getElementById('animal-form');
        const preview = document.getElementById('animal-preview');
        const animalsList = document.getElementById('animals-list');
        const clearBtn = document.getElementById('clear-btn');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const submitBtn = document.getElementById('submit-btn');
        const submitText = document.getElementById('submit-text');
        const exportBtn = document.getElementById('export-btn');
        const colorInput = document.getElementById('animal-color');
        const colorHexInput = document.getElementById('animal-color-hex');

        // åˆå§‹åŒ–
        function init() {
            renderAnimalsList();
            setupFormListeners();
            updateAnimalCount();
            syncColorInputs();
            setupSkillModal();
            setupAvatarUpload();
        }
        
        // è®¾ç½®å¤´åƒä¸Šä¼ 
        function setupAvatarUpload() {
            const avatarInput = document.getElementById('animal-avatar-input');
            const avatarFilename = document.getElementById('avatar-filename');
            const avatarPreview = document.getElementById('avatar-preview');
            const avatarPreviewImg = document.getElementById('avatar-preview-img');
            const clearAvatarBtn = document.getElementById('clear-avatar-btn');
            
            avatarInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶2MBï¼‰
                if (file.size > 2 * 1024 * 1024) {
                    alert('âŒ å›¾ç‰‡æ–‡ä»¶è¿‡å¤§ï¼è¯·é€‰æ‹©å°äº2MBçš„å›¾ç‰‡ã€‚');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    const base64Data = event.target.result;
                    currentAvatarData = base64Data;
                    avatarModified = true;
                    
                    avatarPreviewImg.src = base64Data;
                    avatarPreview.classList.remove('hidden');
                    avatarFilename.textContent = file.name;
                    clearAvatarBtn.classList.remove('hidden');
                    updatePreview();
                };
                reader.readAsDataURL(file);
            });
            
            clearAvatarBtn.addEventListener('click', () => {
                currentAvatarData = null;
                avatarModified = true;
                avatarInput.value = '';
                avatarPreview.classList.add('hidden');
                avatarFilename.textContent = 'ç‚¹å‡»é€‰æ‹©å›¾ç‰‡';
                clearAvatarBtn.classList.add('hidden');
                updatePreview();
            });
        }

        // è®¾ç½®æŠ€èƒ½æ± é€‰æ‹©å™¨
        function setupSkillModal() {
            const skillpoolSelect = document.getElementById('skillpool-select');
            
            loadSkillPoolOptions();
            
            skillpoolSelect.addEventListener('change', function() {
                const poolKey = this.value;
                if (poolKey) {
                    showSkillPoolInfo(poolKey);
                } else {
                    document.getElementById('selected-skillpool-info').classList.add('hidden');
                }
                updatePreview();
            });
            
            window.addEventListener('focus', function() {
                const currentValue = skillpoolSelect.value;
                loadSkillPoolOptions(currentValue);
            });
        }

        // åŠ è½½æŠ€èƒ½æ± é€‰é¡¹
        function loadSkillPoolOptions(selectedKey = '') {
            const skillPools = JSON.parse(localStorage.getItem('SKILL_POOLS') || '[]');
            const skillpoolSelect = document.getElementById('skillpool-select');
            
            skillpoolSelect.innerHTML = '<option value="">-- é€‰æ‹©æŠ€èƒ½æ±  --</option>';
            
            skillPools.forEach(pool => {
                const option = document.createElement('option');
                option.value = pool.key;
                option.textContent = `${pool.icon} ${pool.name} (${pool.skills.length}ä¸ªæŠ€èƒ½)`;
                skillpoolSelect.appendChild(option);
            });
            
            if (selectedKey) {
                skillpoolSelect.value = selectedKey;
                if (skillpoolSelect.value === selectedKey) {
                    showSkillPoolInfo(selectedKey);
                }
            } else {
                document.getElementById('selected-skillpool-info').classList.add('hidden');
            }
        }

        // æ˜¾ç¤ºé€‰ä¸­çš„æŠ€èƒ½æ± ä¿¡æ¯
        function showSkillPoolInfo(poolKey) {
            const skillPools = JSON.parse(localStorage.getItem('SKILL_POOLS') || '[]');
            const pool = skillPools.find(p => p.key === poolKey);
            
            if (!pool) {
                document.getElementById('selected-skillpool-info').classList.add('hidden');
                return;
            }

            const totalWeight = pool.skills.reduce((sum, s) => sum + (s.weight || 0), 0);
            const rarityStats = {};
            pool.skills.forEach(s => {
                rarityStats[s.rarity] = (rarityStats[s.rarity] || 0) + 1;
            });

            const rarityLabels = {
                'common': 'âšªæ™®é€š',
                'rare': 'âœ¨ç¨€æœ‰',
                'epic': 'ğŸŒˆå²è¯—',
                'legendary': 'â­ä¼ è¯´'
            };

            const infoDiv = document.getElementById('selected-skillpool-info');
            infoDiv.innerHTML = `
                <div class="flex items-start gap-2">
                    <div class="text-2xl">${pool.icon}</div>
                    <div class="flex-1">
                        <div class="text-sm font-bold text-purple-300 mb-1">${pool.name}</div>
                        ${pool.description ? `<div class="text-xs text-gray-400 mb-2">${pool.description}</div>` : ''}
                        <div class="flex gap-2 text-xs mb-2">
                            <span class="text-purple-200">ğŸ“Š ${pool.skills.length}ä¸ªæŠ€èƒ½</span>
                            <span class="${totalWeight === 100 ? 'text-green-400' : 'text-yellow-400'}">âš–ï¸ ${totalWeight.toFixed(1)}%</span>
                        </div>
                        <div class="flex gap-1 text-xs flex-wrap">
                            ${Object.entries(rarityStats).map(([r, c]) =>
                                `<span class="bg-purple-600/20 text-purple-200 px-2 py-0.5 rounded">${rarityLabels[r]}Ã—${c}</span>`
                            ).join('')}
                        </div>
                    </div>
                </div>
            `;
            infoDiv.classList.remove('hidden');
        }

        // åŒæ­¥é¢œè‰²è¾“å…¥
        function syncColorInputs() {
            colorInput.addEventListener('input', (e) => {
                colorHexInput.value = e.target.value.toUpperCase();
                updatePreview();
            });

            colorHexInput.addEventListener('input', (e) => {
                const hex = e.target.value;
                if (/^#[0-9A-Fa-f]{6}$/.test(hex)) {
                    colorInput.value = hex;
                    updatePreview();
                }
            });
        }

        // æ›´æ–°åŠ¨ç‰©æ•°é‡æ˜¾ç¤º
        function updateAnimalCount() {
            document.getElementById('animal-count').textContent = animals.length;
        }

        // è®¾ç½®è¡¨å•ç›‘å¬å™¨
        function setupFormListeners() {
            // å®æ—¶é¢„è§ˆ
            form.querySelectorAll('input, select, textarea').forEach(input => {
                input.addEventListener('input', updatePreview);
            });

            // æäº¤è¡¨å•
            form.onsubmit = (e) => {
                e.preventDefault();
                if (editingIndex >= 0) {
                    updateAnimal();
                } else {
                    createAnimal();
                }
            };

            // æ¸…ç©ºæŒ‰é’®
            clearBtn.onclick = () => {
                form.reset();
                currentAvatarData = null;
                avatarModified = false;
                document.getElementById('animal-avatar-input').value = '';
                document.getElementById('avatar-preview').classList.add('hidden');
                document.getElementById('avatar-filename').textContent = 'ç‚¹å‡»é€‰æ‹©å›¾ç‰‡';
                document.getElementById('clear-avatar-btn').classList.add('hidden');
                loadSkillPoolOptions('');
                cancelEdit();
                updatePreview();
            };

            // å–æ¶ˆç¼–è¾‘æŒ‰é’®
            cancelEditBtn.onclick = () => {
                form.reset();
                currentAvatarData = null;
                avatarModified = false;
                document.getElementById('animal-avatar-input').value = '';
                document.getElementById('avatar-preview').classList.add('hidden');
                document.getElementById('avatar-filename').textContent = 'ç‚¹å‡»é€‰æ‹©å›¾ç‰‡';
                document.getElementById('clear-avatar-btn').classList.add('hidden');
                loadSkillPoolOptions('');
                cancelEdit();
                updatePreview();
            };

            // å¯¼å‡ºæŒ‰é’®
            exportBtn.onclick = exportAnimals;
            document.getElementById('export-csv-btn').onclick = exportAnimalsToCSV;

            // å¯¼å…¥æŒ‰é’®
            document.getElementById('import-file').onchange = importAnimals;

            // åº”ç”¨åˆ°æ¸¸æˆæŒ‰é’®
            document.getElementById('apply-to-game-btn').onclick = applyToGame;
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const data = getFormData();
            if (!data.name) {
                preview.innerHTML = `
                    <div class="text-center text-gray-500">
                        <div class="text-4xl mb-2">â“</div>
                        <div class="text-sm">å¡«å†™è¡¨å•æŸ¥çœ‹é¢„è§ˆ</div>
                    </div>
                `;
                return;
            }

            const elementClass = data.element ? `element-${data.element}` : 'bg-gray-700';
            const rarityClass = data.rarity ? `rarity-${data.rarity}` : 'bg-gray-700';
            
            // å¤´åƒæˆ–é¢œè‰²é¢„è§ˆ
            let avatarHtml;
            if (currentAvatarData) {
                avatarHtml = `<img src="${currentAvatarData}" class="color-preview object-cover" alt="å¤´åƒé¢„è§ˆ">`;
            } else {
                avatarHtml = `<div class="color-preview" style="background-color: ${data.color}"></div>`;
            }

            preview.innerHTML = `
                <div class="flex items-start gap-3">
                    ${avatarHtml}
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-2">
                            <h4 class="text-lg font-bold text-white">${data.name}</h4>
                            <span class="badge ${elementClass}">${getElementName(data.element)}</span>
                            <span class="badge ${rarityClass}">${getRarityName(data.rarity)}</span>
                        </div>
                        <p class="text-xs text-gray-300 mb-2">${data.desc || 'æš‚æ— æè¿°'}</p>
                        <div class="grid grid-cols-3 gap-2 text-xs">
                            <div class="bg-orange-600/20 text-orange-300 px-2 py-1 rounded">ğŸ“Š Lv.${data.level}</div>
                            <div class="bg-cyan-600/20 text-cyan-300 px-2 py-1 rounded">ğŸ“ˆ ${data.baseExp}Ã—${data.expGrowth}</div>
                            <div class="bg-pink-600/20 text-pink-300 px-2 py-1 rounded">ğŸ’— ${data.health}</div>
                            <div class="bg-green-600/20 text-green-300 px-2 py-1 rounded">ğŸ’ª ${data.stamina}</div>
                            <div class="bg-red-600/20 text-red-300 px-2 py-1 rounded">âš”ï¸ ${data.attack}</div>
                            <div class="bg-blue-600/20 text-blue-300 px-2 py-1 rounded">ğŸ›¡ï¸ ${data.defense}</div>
                            <div class="bg-yellow-600/20 text-yellow-300 px-2 py-1 rounded">âš¡ ${data.agility}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // è·å–è¡¨å•æ•°æ®
        function getFormData() {
            return {
                animalId: document.getElementById('animal-id').value.toUpperCase(),
                name: document.getElementById('animal-name').value,
                color: document.getElementById('animal-color-hex').value,
                element: document.getElementById('animal-element').value,
                rarity: document.getElementById('animal-rarity').value,
                level: parseInt(document.getElementById('animal-level').value) || 1,
                baseExp: parseInt(document.getElementById('animal-base-exp').value) || 100,
                expGrowth: parseFloat(document.getElementById('animal-exp-growth').value) || 1.2,
                health: parseInt(document.getElementById('animal-health').value) || 100,
                stamina: parseInt(document.getElementById('animal-stamina').value) || 100,
                attack: parseInt(document.getElementById('animal-attack').value) || 10,
                defense: parseInt(document.getElementById('animal-defense').value) || 5,
                agility: parseInt(document.getElementById('animal-agility').value) || 8,
                favorability: parseInt(document.getElementById('animal-favorability').value) || 50,
                growthTypes: {
                    mediocre: {
                        health: parseInt(document.getElementById('growth-mediocre-health').value) || 10,
                        stamina: parseInt(document.getElementById('growth-mediocre-stamina').value) || 8,
                        attack: parseInt(document.getElementById('growth-mediocre-attack').value) || 2,
                        defense: parseInt(document.getElementById('growth-mediocre-defense').value) || 1,
                        agility: parseInt(document.getElementById('growth-mediocre-agility').value) || 1,
                        favorability: parseInt(document.getElementById('growth-mediocre-favorability').value) || 3
                    },
                    extraordinary: {
                        health: parseInt(document.getElementById('growth-extraordinary-health').value) || 15,
                        stamina: parseInt(document.getElementById('growth-extraordinary-stamina').value) || 12,
                        attack: parseInt(document.getElementById('growth-extraordinary-attack').value) || 3,
                        defense: parseInt(document.getElementById('growth-extraordinary-defense').value) || 2,
                        agility: parseInt(document.getElementById('growth-extraordinary-agility').value) || 2,
                        favorability: parseInt(document.getElementById('growth-extraordinary-favorability').value) || 5
                    },
                    brilliant: {
                        health: parseInt(document.getElementById('growth-brilliant-health').value) || 20,
                        stamina: parseInt(document.getElementById('growth-brilliant-stamina').value) || 16,
                        attack: parseInt(document.getElementById('growth-brilliant-attack').value) || 4,
                        defense: parseInt(document.getElementById('growth-brilliant-defense').value) || 3,
                        agility: parseInt(document.getElementById('growth-brilliant-agility').value) || 3,
                        favorability: parseInt(document.getElementById('growth-brilliant-favorability').value) || 7
                    }
                },
                skillPoolKey: document.getElementById('skillpool-select').value || null,
                desc: document.getElementById('animal-desc').value
            };
        }

        // åˆ›å»ºåŠ¨ç‰©æ¨¡æ¿
        function createAnimal() {
            const data = getFormData();
            const animalKey = `ANIMAL_${Date.now()}`;
            
            const animal = {
                key: animalKey,
                ...data,
                avatarData: currentAvatarData,
                createdAt: new Date().toISOString()
            };

            try {
                animals.push(animal);
                saveAnimalPool();
                
                renderAnimalsList();
                updateAnimalCount();
                form.reset();
                loadSkillPoolOptions('');
                updatePreview();
                
                const skillPoolMsg = animal.skillPoolKey ? '\nâœ… å·²å…³è”æŠ€èƒ½æ± ' : '\nâš ï¸ æœªé€‰æ‹©æŠ€èƒ½æ± ';
                alert(`âœ… åŠ¨ç‰©æ¨¡æ¿ "${data.name}" å·²æ·»åŠ åˆ°æ¨¡æ¿æ± ï¼${skillPoolMsg}`);
            } catch (error) {
                animals.pop();
                if (error.name === 'QuotaExceededError') {
                    alert('âŒ ä¿å­˜å¤±è´¥ï¼šå­˜å‚¨ç©ºé—´ä¸è¶³ï¼\n\nå»ºè®®ï¼šåˆ é™¤ä¸€äº›æ—§çš„åŠ¨ç‰©æ¨¡æ¿æˆ–å¯¼å‡ºå¹¶æ¸…ç©ºå½“å‰æ¨¡æ¿æ± ');
                } else {
                    alert('âŒ ä¿å­˜å¤±è´¥ï¼š' + error.message);
                }
                console.error('ä¿å­˜å¤±è´¥:', error);
            }
        }

        // æ›´æ–°åŠ¨ç‰©æ¨¡æ¿
        function updateAnimal() {
            const data = getFormData();
            const originalAnimal = {...animals[editingIndex]};
            
            const animal = {
                key: animals[editingIndex].key,
                ...data,
                avatarData: avatarModified ? currentAvatarData : animals[editingIndex].avatarData,
                createdAt: animals[editingIndex].createdAt,
                updatedAt: new Date().toISOString()
            };

            try {
                animals[editingIndex] = animal;
                saveAnimalPool();
                
                renderAnimalsList();
                updateAnimalCount();
                form.reset();
                loadSkillPoolOptions('');
                cancelEdit();
                updatePreview();
                
                alert(`âœ… åŠ¨ç‰©æ¨¡æ¿ "${data.name}" å·²æ›´æ–°ï¼`);
            } catch (error) {
                animals[editingIndex] = originalAnimal;
                if (error.name === 'QuotaExceededError') {
                    alert('âŒ æ›´æ–°å¤±è´¥ï¼šå­˜å‚¨ç©ºé—´ä¸è¶³ï¼');
                } else {
                    alert('âŒ æ›´æ–°å¤±è´¥ï¼š' + error.message);
                }
                console.error('æ›´æ–°å¤±è´¥:', error);
            }
        }

        // ç¼–è¾‘åŠ¨ç‰©æ¨¡æ¿
        function editAnimal(index) {
            editingIndex = index;
            avatarModified = false;
            const animal = animals[index];
            
            // å¡«å……è¡¨å•
            document.getElementById('animal-id').value = animal.animalId || '';
            document.getElementById('animal-name').value = animal.name;
            document.getElementById('animal-color').value = animal.color;
            document.getElementById('animal-color-hex').value = animal.color;
            document.getElementById('animal-element').value = animal.element;
            document.getElementById('animal-rarity').value = animal.rarity;
            document.getElementById('animal-level').value = animal.level;
            document.getElementById('animal-base-exp').value = animal.baseExp;
            document.getElementById('animal-exp-growth').value = animal.expGrowth;
            document.getElementById('animal-health').value = animal.health;
            document.getElementById('animal-stamina').value = animal.stamina;
            document.getElementById('animal-attack').value = animal.attack;
            document.getElementById('animal-defense').value = animal.defense;
            document.getElementById('animal-agility').value = animal.agility;
            document.getElementById('animal-favorability').value = animal.favorability;
            
            // å¡«å……ä¸‰ç§æˆé•¿é…ç½®
            if (animal.growthTypes) {
                document.getElementById('growth-mediocre-health').value = animal.growthTypes.mediocre.health;
                document.getElementById('growth-mediocre-stamina').value = animal.growthTypes.mediocre.stamina;
                document.getElementById('growth-mediocre-attack').value = animal.growthTypes.mediocre.attack;
                document.getElementById('growth-mediocre-defense').value = animal.growthTypes.mediocre.defense;
                document.getElementById('growth-mediocre-agility').value = animal.growthTypes.mediocre.agility;
                document.getElementById('growth-mediocre-favorability').value = animal.growthTypes.mediocre.favorability;
                
                document.getElementById('growth-extraordinary-health').value = animal.growthTypes.extraordinary.health;
                document.getElementById('growth-extraordinary-stamina').value = animal.growthTypes.extraordinary.stamina;
                document.getElementById('growth-extraordinary-attack').value = animal.growthTypes.extraordinary.attack;
                document.getElementById('growth-extraordinary-defense').value = animal.growthTypes.extraordinary.defense;
                document.getElementById('growth-extraordinary-agility').value = animal.growthTypes.extraordinary.agility;
                document.getElementById('growth-extraordinary-favorability').value = animal.growthTypes.extraordinary.favorability;
                
                document.getElementById('growth-brilliant-health').value = animal.growthTypes.brilliant.health;
                document.getElementById('growth-brilliant-stamina').value = animal.growthTypes.brilliant.stamina;
                document.getElementById('growth-brilliant-attack').value = animal.growthTypes.brilliant.attack;
                document.getElementById('growth-brilliant-defense').value = animal.growthTypes.brilliant.defense;
                document.getElementById('growth-brilliant-agility').value = animal.growthTypes.brilliant.agility;
                document.getElementById('growth-brilliant-favorability').value = animal.growthTypes.brilliant.favorability;
            }
            
            document.getElementById('animal-desc').value = animal.desc || '';
            
            loadSkillPoolOptions(animal.skillPoolKey || '');
            
            // æ¢å¤å¤´åƒ
            if (animal.avatarData) {
                currentAvatarData = animal.avatarData;
                document.getElementById('avatar-preview-img').src = animal.avatarData;
                document.getElementById('avatar-preview').classList.remove('hidden');
                document.getElementById('avatar-filename').textContent = 'å·²åŠ è½½ä¿å­˜çš„å¤´åƒ';
                document.getElementById('clear-avatar-btn').classList.remove('hidden');
            } else {
                currentAvatarData = null;
                document.getElementById('avatar-preview').classList.add('hidden');
                document.getElementById('avatar-filename').textContent = 'ç‚¹å‡»é€‰æ‹©å›¾ç‰‡';
                document.getElementById('clear-avatar-btn').classList.add('hidden');
            }
            
            // æ›´æ–°UI
            submitText.textContent = 'ğŸ’¾ ä¿å­˜ä¿®æ”¹';
            submitBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
            submitBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
            cancelEditBtn.classList.remove('hidden');
            
            updatePreview();
            
            form.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // å–æ¶ˆç¼–è¾‘
        function cancelEdit() {
            editingIndex = -1;
            submitText.textContent = 'âœ¨ åˆ›å»ºåŠ¨ç‰©æ¨¡æ¿';
            submitBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            submitBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            cancelEditBtn.classList.add('hidden');
        }

        // ä¿å­˜åŠ¨ç‰©æ¨¡æ¿æ± 
        function saveAnimalPool() {
            try {
                const jsonStr = JSON.stringify(animals);
                const sizeInMB = (jsonStr.length / (1024 * 1024)).toFixed(2);
                console.log(`ğŸ’¾ ä¿å­˜åŠ¨ç‰©æ¨¡æ¿æ± ï¼Œå¤§å°: ${sizeInMB}MB`);
                
                localStorage.setItem('ANIMAL_POOL', jsonStr);
            } catch (error) {
                if (error.name === 'QuotaExceededError') {
                    console.error('âŒ localStorageé…é¢è¶…é™');
                    throw error;
                } else {
                    console.error('âŒ ä¿å­˜å¤±è´¥:', error);
                    throw error;
                }
            }
        }

        // æ¸²æŸ“åŠ¨ç‰©åˆ—è¡¨
        function renderAnimalsList() {
            if (animals.length === 0) {
                animalsList.innerHTML = `
                    <div class="text-center text-gray-500 text-sm py-8">
                        æš‚æ— åŠ¨ç‰©æ¨¡æ¿
                    </div>
                `;
                return;
            }

            animalsList.innerHTML = animals.map((animal, index) => {
                const elementClass = `element-${animal.element}`;
                const rarityClass = `rarity-${animal.rarity}`;
                
                // å¤´åƒæˆ–é¢œè‰²çƒ
                let avatarHtml;
                if (animal.avatarData) {
                    avatarHtml = `<img src="${animal.avatarData}" class="w-12 h-12 rounded-full border-2 border-white object-cover" alt="${animal.name}">`;
                } else {
                    avatarHtml = `<div class="w-12 h-12 rounded-full border-2 border-white" style="background-color: ${animal.color}"></div>`;
                }
                
                return `
                    <div class="animal-card bg-gray-800 rounded-lg p-3 border border-gray-600">
                        <div class="flex items-start gap-2">
                            ${avatarHtml}
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-1 flex-wrap">
                                    <h5 class="text-sm font-bold text-white">${animal.name}</h5>
                                    <span class="badge ${elementClass} text-xs">${getElementName(animal.element)}</span>
                                    <span class="badge ${rarityClass} text-xs">${getRarityName(animal.rarity)}</span>
                                </div>
                                <div class="flex gap-2 text-xs flex-wrap">
                                    <span class="text-orange-400">ğŸ“ŠLv.${animal.level}</span>
                                    <span class="text-pink-400">ğŸ’—${animal.health}</span>
                                    <span class="text-red-400">âš”ï¸${animal.attack}</span>
                                    <span class="text-blue-400">ğŸ›¡ï¸${animal.defense}</span>
                                    <span class="text-yellow-400">âš¡${animal.agility}</span>
                                </div>
                            </div>
                            <div class="flex gap-1 flex-shrink-0">
                                <button onclick="editAnimal(${index})"
                                    class="text-blue-400 hover:text-blue-300 text-lg px-2"
                                    title="ç¼–è¾‘">
                                    âœï¸
                                </button>
                                <button onclick="deleteAnimal(${index})"
                                    class="text-red-400 hover:text-red-300 text-xl"
                                    title="åˆ é™¤">
                                    Ã—
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åˆ é™¤åŠ¨ç‰©æ¨¡æ¿
        function deleteAnimal(index) {
            if (confirm('ç¡®å®šè¦ä»æ¨¡æ¿æ± ä¸­åˆ é™¤è¿™ä¸ªåŠ¨ç‰©å—ï¼Ÿ')) {
                animals.splice(index, 1);
                saveAnimalPool();
                renderAnimalsList();
                updateAnimalCount();
            }
        }

        // å¯¼å‡ºåŠ¨ç‰©æ¨¡æ¿æ± ï¼ˆJSONæ ¼å¼ï¼‰
        function exportAnimals() {
            if (animals.length === 0) {
                alert('æ¨¡æ¿æ± ä¸ºç©ºï¼');
                return;
            }

            const dataStr = JSON.stringify(animals, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `animal_pool_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // å¯¼å‡ºåŠ¨ç‰©æ¨¡æ¿æ± ï¼ˆCSVæ ¼å¼ï¼‰
        function exportAnimalsToCSV() {
            if (animals.length === 0) {
                alert('æ¨¡æ¿æ± ä¸ºç©ºï¼');
                return;
            }

            const escapeCSV = (value) => {
                if (value === null || value === undefined) return '';
                const str = String(value);
                if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                    return `"${str.replace(/"/g, '""')}"`;
                }
                return str;
            };

            const headers = [
                'åŠ¨ç‰©ID', 'åŠ¨ç‰©åç§°', 'æè¿°', 'é¢œè‰²', 'ç³»åˆ«', 'ç¨€æœ‰åº¦',
                'åˆå§‹ç­‰çº§', 'åŸºç¡€ç»éªŒå€¼', 'ç»éªŒå¢é•¿ç³»æ•°',
                'ç”Ÿå‘½å€¼', 'ä½“åŠ›', 'æ”»å‡»', 'é˜²å¾¡', 'æ•æ·', 'å¥½æ„Ÿåº¦',
                'å¹³åº¸_ç”Ÿå‘½', 'å¹³åº¸_ä½“åŠ›', 'å¹³åº¸_æ”»å‡»', 'å¹³åº¸_é˜²å¾¡', 'å¹³åº¸_æ•æ·', 'å¹³åº¸_å¥½æ„Ÿ',
                'è¶…å¸¸_ç”Ÿå‘½', 'è¶…å¸¸_ä½“åŠ›', 'è¶…å¸¸_æ”»å‡»', 'è¶…å¸¸_é˜²å¾¡', 'è¶…å¸¸_æ•æ·', 'è¶…å¸¸_å¥½æ„Ÿ',
                'ç’€ç’¨_ç”Ÿå‘½', 'ç’€ç’¨_ä½“åŠ›', 'ç’€ç’¨_æ”»å‡»', 'ç’€ç’¨_é˜²å¾¡', 'ç’€ç’¨_æ•æ·', 'ç’€ç’¨_å¥½æ„Ÿ',
                'å…³è”æŠ€èƒ½æ± ', 'æ˜¯å¦æœ‰å¤´åƒ', 'åˆ›å»ºæ—¶é—´', 'æ›´æ–°æ—¶é—´'
            ];

            let csvContent = headers.join(',') + '\n';

            animals.forEach(animal => {
                const row = [
                    escapeCSV(animal.animalId || ''),
                    escapeCSV(animal.name),
                    escapeCSV(animal.desc || ''),
                    escapeCSV(animal.color),
                    escapeCSV(getElementName(animal.element)),
                    escapeCSV(getRarityName(animal.rarity)),
                    escapeCSV(animal.level),
                    escapeCSV(animal.baseExp),
                    escapeCSV(animal.expGrowth),
                    escapeCSV(animal.health),
                    escapeCSV(animal.stamina),
                    escapeCSV(animal.attack),
                    escapeCSV(animal.defense),
                    escapeCSV(animal.agility),
                    escapeCSV(animal.favorability)
                ];

                if (animal.growthTypes) {
                    ['mediocre', 'extraordinary', 'brilliant'].forEach(type => {
                        const growth = animal.growthTypes[type] || {};
                        row.push(
                            escapeCSV(growth.health || 0),
                            escapeCSV(growth.stamina || 0),
                            escapeCSV(growth.attack || 0),
                            escapeCSV(growth.defense || 0),
                            escapeCSV(growth.agility || 0),
                            escapeCSV(growth.favorability || 0)
                        );
                    });
                } else {
                    for (let i = 0; i < 18; i++) row.push('');
                }

                const skillPoolKey = animal.skillPoolKey;
                let skillPoolName = '';
                if (skillPoolKey) {
                    const skillPools = JSON.parse(localStorage.getItem('SKILL_POOLS') || '[]');
                    const pool = skillPools.find(p => p.key === skillPoolKey);
                    skillPoolName = pool ? pool.name : skillPoolKey;
                }

                row.push(
                    escapeCSV(skillPoolName),
                    escapeCSV(animal.avatarData ? 'æ˜¯' : 'å¦'),
                    escapeCSV(animal.createdAt ? new Date(animal.createdAt).toLocaleString('zh-CN') : ''),
                    escapeCSV(animal.updatedAt ? new Date(animal.updatedAt).toLocaleString('zh-CN') : '')
                );

                csvContent += row.join(',') + '\n';
            });

            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `åŠ¨ç‰©é…ç½®è¡¨_${Date.now()}.csv`;
            a.click();
            URL.revokeObjectURL(url);

            alert(`âœ… å·²å¯¼å‡º ${animals.length} ä¸ªåŠ¨ç‰©æ¨¡æ¿åˆ°CSVï¼`);
        }

        // å¯¼å…¥åŠ¨ç‰©æ¨¡æ¿
        function importAnimals(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const importedAnimals = JSON.parse(event.target.result);
                    
                    if (!Array.isArray(importedAnimals)) {
                        alert('âŒ æ— æ•ˆçš„JSONæ ¼å¼ï¼');
                        return;
                    }

                    const existingKeys = new Set(animals.map(a => a.key));
                    const newAnimals = importedAnimals.filter(a => !existingKeys.has(a.key));
                    
                    animals = [...animals, ...newAnimals];
                    saveAnimalPool();
                    
                    renderAnimalsList();
                    updateAnimalCount();
                    alert(`âœ… æˆåŠŸå¯¼å…¥ ${newAnimals.length} ä¸ªæ–°åŠ¨ç‰©æ¨¡æ¿ï¼`);
                } catch (error) {
                    alert('âŒ å¯¼å…¥å¤±è´¥ï¼š' + error.message);
                }
            };
            reader.readAsText(file);
            
            e.target.value = '';
        }

        // åº”ç”¨åˆ°æ¸¸æˆ
        function applyToGame() {
            if (animals.length === 0) {
                alert('âŒ åŠ¨ç‰©æ¨¡æ¿æ± ä¸ºç©ºï¼');
                return;
            }

            const stats = {
                elements: {},
                rarities: {}
            };
            
            animals.forEach(animal => {
                stats.elements[animal.element] = (stats.elements[animal.element] || 0) + 1;
                stats.rarities[animal.rarity] = (stats.rarities[animal.rarity] || 0) + 1;
            });
            
            const elementStats = Object.entries(stats.elements)
                .map(([k, v]) => `${getElementName(k)}: ${v}`)
                .join('\nâ€¢ ');
            
            const rarityStats = Object.entries(stats.rarities)
                .map(([k, v]) => `${getRarityName(k)}: ${v}`)
                .join('\nâ€¢ ');
            
            alert(`âœ… åŠ¨ç‰©æ¨¡æ¿æ± å·²å°±ç»ªï¼\n\n` +
                  `ğŸ“Š æ¨¡æ¿æ± ç»Ÿè®¡ï¼š\n` +
                  `æ€»è®¡ï¼š${animals.length} ä¸ªæ¨¡æ¿\n\n` +
                  `ç³»åˆ«åˆ†å¸ƒï¼š\nâ€¢ ${elementStats}\n\n` +
                  `ç¨€æœ‰åº¦åˆ†å¸ƒï¼š\nâ€¢ ${rarityStats}\n\n` +
                  `æ¸¸æˆä¼šæ ¹æ®æƒé‡ä»æ¨¡æ¿æ± ä¸­éšæœºç”Ÿæˆé‡ç”ŸåŠ¨ç‰©ï¼`);
        }

        // è¾…åŠ©å‡½æ•°
        function getElementName(element) {
            const names = {
                'water': 'æ°´ç³»',
                'fire': 'ç«ç³»',
                'grass': 'è‰ç³»',
                'wind': 'é£ç³»',
                'electric': 'ç”µç³»',
                'earth': 'åœŸç³»'
            };
            return names[element] || 'æœªçŸ¥';
        }

        function getRarityName(rarity) {
            const names = {
                'common': 'æ™®é€š',
                'rare': 'ç¨€æœ‰',
                'epic': 'å²è¯—',
                'legendary': 'ä¼ è¯´',
                'shiny': 'é—ªå…‰',
                'prismatic': 'å¹»å½©',
                'stellar': 'æ˜ŸèŠ’',
                'uncommon': 'ç½•è§',
                'mythic': 'ç¥è¯'
            };
            return names[rarity] || 'æœªçŸ¥';
        }

        // åˆå§‹åŒ–åº”ç”¨
        init();
    </script>
</body>
</html>